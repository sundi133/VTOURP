/*
  OpenTok JavaScript Library v2.0.22
 http://www.tokbox.com/

 Copyright (c) 2013 TokBox, Inc.

 Date: July 17 01:36:39 2014
  Common JS Helpers on OpenTok 0.1.0 f132e57 master-webrtc-2.0
 http://www.tokbox.com/

 Copyright (c) 2014 TokBox, Inc.

 Date: April 15 04:32:20 2014

*/
(function(k){k.OT||(k.OT={});OT.properties={version:"v2.0.22",build:"5f51a79",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"https://anvil.opentok.com",messagingProtocol:"wss",messagingPort:443,supportSSL:"true",cdnURLSSL:"https://static.opentok.com",loggingURLSSL:"https://hlg.tokbox.com/prod",
minimumVersion:{firefox:parseFloat("26"),chrome:parseFloat("32")}}})(window);
!function(k,d){var f=function(a){return document.getElementById(a)},e=k.OTHelpers;k.OTHelpers=f;f.noConflict=function(){f.noConflict=function(){return f};k.OTHelpers=e;return f};var a=Array.prototype.forEach||function(a){for(var b=0,c=this.length||0;b<c;++b)b in this&&a(this[b],b)};f.forEach=function(b,c){return a.call(b,c)};f.isNone=function(a){return a===d||null===a};f.isObject=function(a){return a===Object(a)};f.isFunction=function(a){return"function"===typeof a};f.isArray=f.isFunction(Array.isArray)&&
Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};f.isEmpty=function(a){if(null===a||a===d)return!0;if(f.isArray(a)||"string"===typeof a)return 0===a.length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};f.extend=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();a.forEach(function(a){for(var c in a)b[c]=a[c]});return b};f.defaults=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();a.forEach(function(a){for(var c in a)void 0===
b[c]&&(b[c]=a[c])});return b};f.clone=function(a){return!f.isObject(a)?a:f.isArray(a)?a.slice():f.extend({},a)};f.noop=function(){};f.supportsWebSockets=function(){return"WebSocket"in k};f.now=function(){var a=k.performance||{},b,c=a.now||a.mozNow||a.msNow||a.oNow||a.webkitNow;return c?(c=c.bind(a),b=a.timing.navigationStart,function(){return b+c()}):function(){return(new Date).getTime()}}();var b=function(){var a=k.navigator.userAgent.toLowerCase(),b=k.navigator.appName,c,g="unknown",h=-1;if(-1<
a.indexOf("opera")||-1<a.indexOf("opr"))g="Opera",null!==/opr\/([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));else if(-1<a.indexOf("firefox"))g="Firefox",null!==/firefox\/([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));else if("Microsoft Internet Explorer"===b)g="IE",null!==/msie ([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));else if("Netscape"===b&&-1<a.indexOf("trident"))g="IE",null!==/trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));else if(-1<
a.indexOf("chrome"))g="Chrome",null!==/chrome\/([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));else if((c=k.navigator.vendor)&&-1<c.toLowerCase().indexOf("apple"))g="Safari",null!==/version\/([0-9]{1,}[\.0-9]{0,})/.exec(a)&&(h=parseFloat(RegExp.$1));return{browser:g,version:h,iframeNeedsLoad:0>a.indexOf("webkit")}}();f.browser=function(){return b.browser};f.browserVersion=function(){return b};f.canDefineProperty=!0;try{Object.defineProperty({},"x",{})}catch(c){f.canDefineProperty=!1}f.defineGetters=
function(a,b,c){var g={};void 0===c&&(c=!1);for(var h in b)g[h]={get:b[h],enumerable:c};Object.defineProperties(a,g)};Object.create||(Object.create=function(a){function b(){}if(1<arguments.length)throw Error("Object.create implementation only accepts the first parameter.");b.prototype=a;return new b});f.setCookie=function(a,b){try{localStorage.setItem(a,b)}catch(c){var g=new Date;g.setTime(g.getTime()+31536E6);g="; expires\x3d"+g.toGMTString();document.cookie=a+"\x3d"+b+g+"; path\x3d/"}};f.getCookie=
function(a){var b;try{return b=localStorage.getItem("opentok_client_id")}catch(c){a+="\x3d";for(var g=document.cookie.split(";"),h=0;h<g.length;h++){for(var d=g[h];" "==d.charAt(0);)d=d.substring(1,d.length);0===d.indexOf(a)&&(b=d.substring(a.length,d.length))}if(b)return b}return null};f.invert=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b};var h={escape:{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"}};h.unescape=
f.invert(h.escape);var g={escape:RegExp("["+Object.keys(h.escape).join("")+"]","g"),unescape:RegExp("("+Object.keys(h.unescape).join("|")+")","g")};["escape","unescape"].forEach(function(a){f[a]=function(b){return null===b||b===d?"":(""+b).replace(g[a],function(b){return h[a][b]})}});f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var l=/(.)^/,r={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},m=/\\|'|\r|\n|\t|\u2028|\u2029/g;
f.template=function(a,b,c){var g;c=f.defaults({},c,f.templateSettings);var h=RegExp([(c.escape||l).source,(c.interpolate||l).source,(c.evaluate||l).source].join("|")+"|$","g"),d=0,e="__p+\x3d'";a.replace(h,function(b,c,g,h,l){e+=a.slice(d,l).replace(m,function(a){return"\\"+r[a]});c&&(e+="'+\n((__t\x3d("+c+"))\x3d\x3dnull?'':OTHelpers.escape(__t))+\n'");g&&(e+="'+\n((__t\x3d("+g+"))\x3d\x3dnull?'':__t)+\n'");h&&(e+="';\n"+h+"\n__p+\x3d'");d=l+b.length;return b});e+="';\n";c.variable||(e="with(obj||{}){\n"+
e+"}\n");e="var __t,__p\x3d'',__j\x3dArray.prototype.join,print\x3dfunction(){__p+\x3d__j.call(arguments,'');};\n"+e+"return __p;\n";try{g=new Function(c.variable||"obj",e)}catch(k){throw k.source=e,k;}if(b)return g(b);b=function(a){return g.call(this,a)};b.source="function("+(c.variable||"obj")+"){\n"+e+"}";return b}}(window);
(function(k,d,f){d.statable=function(e,a,b,c,h){var g,l=b;e.is=function(){return-1!==Array.prototype.indexOf.call(arguments,l)};e.isNot=function(){return-1===Array.prototype.indexOf.call(arguments,l)};Object.defineProperties(e,{state:{get:function(){return l}},previousState:{get:function(){return g}}});return function(b){l!==b&&(-1===a.indexOf(b)?h&&d.isFunction(h)&&h("invalidState",b):(g=l,l=b,c&&d.isFunction(c)&&c(b,g)))}}})(window,window.OTHelpers);
(function(k,d,f){function e(a,b){var c=b||0,g=r;return g[a[c++]]+g[a[c++]]+g[a[c++]]+g[a[c++]]+"-"+g[a[c++]]+g[a[c++]]+"-"+g[a[c++]]+g[a[c++]]+"-"+g[a[c++]]+g[a[c++]]+"-"+g[a[c++]]+g[a[c++]]+g[a[c++]]+g[a[c++]]+g[a[c++]]+g[a[c++]]}function a(a,b,c){c=b&&c||0;"string"==typeof a&&(b="binary"==a?new l(16):null,a=null);a=a||{};a=a.random||(a.rng||g)();a[6]=a[6]&15|64;a[8]=a[8]&63|128;if(b)for(var h=0;16>h;h++)b[c+h]=a[h];return b||e(a)}var b,c=Array(16);f=function(){for(var a,b=0,b=0;16>b;b++)0===(b&
3)&&(a=4294967296*Math.random()),c[b]=a>>>((b&3)<<3)&255;return c};if(k.crypto&&crypto.getRandomValues){var h=new Uint32Array(4);b=function(){crypto.getRandomValues(h);for(var a=0;16>a;a++)c[a]=h[a>>2]>>>8*(a&3)&255;return c}}var g=b||f,l="function"==typeof Buffer?Buffer:Array,r=[],m={};for(k=0;256>k;k++)r[k]=(k+256).toString(16).substr(1),m[r[k]]=k;a.v4=a;a.parse=function(a,b,c){var g=b&&c||0,h=0;b=b||[];for(a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>h&&(b[g+h++]=m[a])});16>h;)b[g+h++]=
0;return b};a.unparse=e;a.BufferClass=l;a.mathRNG=f;a.whatwgRNG=b;d.uuid=a})(window,window.OTHelpers);
(function(k,d,f){function e(a){Object.defineProperty(a.prototype,"firstElementChild",{get:function(){var a;for(a=this.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}});Object.defineProperty(a.prototype,"lastElementChild",{get:function(){var a;for(a=this.lastChild;a&&1!=a.nodeType;)a=a.previousSibling;return a}});Object.defineProperty(a.prototype,"nextElementSibling",{get:function(){for(var a=this;!d.isNone(a=a.nextSibling)&&1!=a.nodeType;);return a}});Object.defineProperty(a.prototype,"previousElementSibling",
{get:function(){for(var a=this;!d.isNone(a=a.previousSibling)&&1!=a.nodeType;);return a}})}d.parseXML=function(a){var b;k.DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a),e(b));a=b.documentElement;return!a||!a.nodeName||"parsererror"===a.nodeName?null:b}})(window,window.OTHelpers);
(function(k,d,f){d.useLogHelpers=function(d){function a(a,c,f){return function(){if(d.shouldLog(c)){var m=k.console;if(m&&m[a])if(m[a].apply||Function.prototype.bind)m[a].apply||(m[a]=Function.prototype.bind.call(m[a],m)),m[a].apply(m,arguments);else m[a](Array.prototype.slice.apply(arguments).join(" "));else f&&f.apply(d,arguments);if(m=arguments){var p;try{p=JSON.stringify(m)}catch(q){p=m.toString()}2>=p.length||h.push([a,b(),p])}}}}function b(){var a=new Date;return a.toLocaleTimeString()+a.getMilliseconds()}
d.DEBUG=5;d.LOG=4;d.INFO=3;d.WARN=2;d.ERROR=1;d.NONE=0;var c=d.NONE,h=[];d.log=a("log",d.LOG);d.debug=a("debug",d.DEBUG,d.log);d.info=a("info",d.INFO,d.log);d.warn=a("warn",d.WARN,d.log);d.error=a("error",d.ERROR,d.log);d.setLogLevel=function(a){c="number"===typeof a?a:0;d.debug("TB.setLogLevel("+c+")");return c};d.getLogs=function(){return h};d.shouldLog=function(a){return c>=a}};d.useLogHelpers(d);d.setLogLevel(d.ERROR)})(window,window.OTHelpers);
(function(k,d,f){d.castToBoolean=function(d,a){return d===f?a:"true"===d||!0===d};d.roundFloat=function(d,a){return Number(d.toFixed(a))}})(window,window.OTHelpers);
(function(k,d,f){var e=[],a="OTHelpers."+d.uuid.v4()+".zero-timeout";k.addEventListener("message",function(b){b.source==k&&b.data==a&&(b.stopPropagation(),0<e.length&&(b=e.shift(),b.shift().apply(null,b)))},!0);d.callAsync=function(){e.push(Array.prototype.slice.call(arguments));k.postMessage(a,"*")};d.createAsyncHandler=function(a){return function(){var c=Array.prototype.slice.call(arguments);d.callAsync(function(){a.apply(null,c)})}}})(window,window.OTHelpers);
(function(k,d,f){d.eventing=function(e,a){function b(a,b,c){var g=h[a];if(g&&0!==g.length){var e=g.length;g.forEach(function(g){function f(a){return a.context===g.context&&a.handler===g.handler}d.callAsync(function(){try{h[a]&&h[a].some(f)&&(g.closure||g.handler).apply(g.context||null,b)}finally{e--,0===e&&c&&c.apply(null,b.slice())}})})}}function c(a,b){var c=h[a];c&&0!==c.length&&c.forEach(function(a){(a.closure||a.handler).apply(a.context||null,b)})}var h={},g=!0===a?c:b,l=function(a,b){h[a]&&
(b?h[a]=h[a].filter(function(a){return a.context!==b}):delete h[a])},f=function(a,b,c,g){var d={handler:b};c&&(d.context=c);g&&(d.closure=g);a.forEach(function(a){h[a]||(h[a]=[]);h[a].push(d)})}.bind(e),m=function(a,b,c){function g(a){return!(a.handler===b&&a.context===c)}a.forEach(function(a){h[a]&&(h[a]=h[a].filter(g),0===h[a].length&&delete h[a])})}.bind(e);e.dispatchEvent=function(a,b){if(!a.type)throw d.error("OTHelpers.Eventing.dispatchEvent: Event has no type"),d.error(a),Error("OTHelpers.Eventing.dispatchEvent: Event has no type");
a.target||(a.target=this);if(!h[a.type]||0===h[a.type].length){var c=[a];b&&b.apply(null,c.slice())}else return g(a.type,[a],b),this};e.trigger=function(a){if(h[a]&&0!==h[a].length){var b=Array.prototype.slice.call(arguments);b.shift();g(a,b);return this}};e.on=function(a,b,c){if("string"===typeof a&&b)f(a.split(" "),b,c);else for(var g in a)a.hasOwnProperty(g)&&f([g],a[g],b);return this};e.off=function(a,b,c){if("string"===typeof a)b&&d.isFunction(b)?m(a.split(" "),b,c):a.split(" ").forEach(function(a){l(a,
b)},this);else if(a)for(var g in a)a.hasOwnProperty(g)&&m([g],a[g],b);else h={};return this};e.once=function(a,b,c){var g=a.split(" ");a=function(){var a=b.apply(c||null,arguments);m(g,b,c);return a}.bind(this);f(g,b,c,a);return this};e.addEventListener=function(a,b,c){d.warn("The addEventListener() method is deprecated. Use on() or once() instead.");f([a],b,c)};e.removeEventListener=function(a,b,c){d.warn("The removeEventListener() method is deprecated. Use off() instead.");m([a],b,c)};return e};
d.eventing.Event=function(){return function(e,a){this.type=e;this.cancelable=a!==f?a:!0;var b=!1,c=null;this.preventDefault=function(){this.cancelable?b=!0:d.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")};this.isDefaultPrevented=function(){return b};d.canDefineProperty&&Object.defineProperty(this,"target",{set:function(a){c=a},get:function(){return c}})}}})(window,window.OTHelpers);
(function(k,d,f){function e(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}d.supportsClassList=function(){var a=typeof("undefined"!==document)&&"classList"in document.createElement("a");d.supportsClassList=function(){return a};return a};d.removeElement=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)};d.removeElementById=function(a){this.removeElement(d(a))};d.removeElementsByType=function(a,b){if(a)for(var c=a.getElementsByTagName(b);c.length;)a.removeChild(c[0])};d.emptyElement=
function(a){for(;a.firstChild;)a.removeChild(a.firstChild);return a};d.createElement=function(a,b,c,h){var g=(h||document).createElement(a);if(b)for(var e in b)if("object"===typeof b[e]){g[e]||(g[e]={});a=b[e];for(var f in a)g[e][f]=a[f]}else"className"===e?g.className=b[e]:g.setAttribute(e,b[e]);b=function(a){"string"===typeof a?g.innerHTML+=a:g.appendChild(a)};d.isArray(c)?d.forEach(c,b):c&&b(c);return g};d.createButton=function(a,b,c){a=d.createElement("button",b,a);if(c){for(var h in c)if(c.hasOwnProperty(h))d.on(a,
h,c[h]);a._boundEvents=c}return a};d.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a["on"+b];a["on"+b]=function(){c.apply(this,arguments);d&&d.apply(this,arguments)}}return a};d.off=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)};d.isDisplayNone=function(a){return(0===a.offsetWidth||0===a.offsetHeight)&&"none"===d.css(a,"display")?!0:a.parentNode&&a.parentNode.style?
d.isDisplayNone(a.parentNode):!1};d.findElementWithDisplayNone=function(a){return(0===a.offsetWidth||0===a.offsetHeight)&&"none"===d.css(a,"display")?a:a.parentNode&&a.parentNode.style?d.findElementWithDisplayNone(a.parentNode):null};d.observeStyleChanges=function(a,b,c){var h={},g=function(b){switch(b){case "width":return d.width(a);case "height":return d.height(a);default:return d.css(a)}};b.forEach(function(a){h[a]=g(a)});var f=new MutationObserver(function(f){var l={};f.forEach(function(c){if("style"===
c.attributeName){var e=d.isDisplayNone(a);b.forEach(function(a){if(!e||!("width"==a||"height"==a)){var b=g(a);b!==h[a]&&(l[a]=[h[a],b],h[a]=b)}})}});e(l)&&d.callAsync(function(){c.call(null,l)})});f.observe(a,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1});return f};d.observeNodeOrChildNodeRemoval=function(a,b){var c=new MutationObserver(function(a){var c=[];a.forEach(function(a){a.removedNodes.length&&(c=c.concat(Array.prototype.slice.call(a.removedNodes)))});
c.length&&d.callAsync(function(){b(c)})});c.observe(a,{attributes:!1,childList:!0,characterData:!1,subtree:!0});return c}})(window,window.OTHelpers);
(function(k,d,f){d.Modal=function(e){d.eventing(this,!0);var a=arguments[arguments.length-1];if(!d.isFunction(a))throw Error("OTHelpers.Modal2 must be given a callback");2>arguments.length&&(e={});var b=document.createElement("iframe");b.id=e.id||d.uuid();b.style.position="absolute";b.style.position="fixed";b.style.height="100%";b.style.width="100%";b.style.top="0px";b.style.left="0px";b.style.right="0px";b.style.bottom="0px";b.style.zIndex=1E3;b.style.border="0";try{b.style.backgroundColor="rgba(0,0,0,0.2)"}catch(c){b.style.backgroundColor=
"transparent",b.setAttribute("allowTransparency","true")}b.scrolling="no";b.setAttribute("scrolling","no");var h=function(){var c=b.contentDocument||b.contentWindow.document;c.body.style.backgroundColor="transparent";c.body.style.border="none";a(b.contentWindow,c)};document.body.appendChild(b);if(d.browserVersion().iframeNeedsLoad)d.on(b,"load",h);else setTimeout(h);this.close=function(){d.removeElement(b);this.trigger("closed");b=null;return this}}})(window,window.OTHelpers);
(function(k,d,f){d.addClass=function(a,b){if(1===a.nodeType){var c=b.trim().split(/\s+/),h,g;if(d.supportsClassList()){h=0;for(g=c.length;h<g;++h)a.classList.add(c[h])}else{if(!a.className&&1===c.length)a.className=b;else{var e=" "+a.className+" ";h=0;for(g=c.length;h<g;++h)~e.indexOf(" "+c[h]+" ")||(e+=c[h]+" ");a.className=e.trim()}return this}}};d.removeClass=function(a,b){if(b&&1===a.nodeType){var c=b.trim().split(/\s+/),h,g;if(d.supportsClassList()){h=0;for(g=c.length;h<g;++h)a.classList.remove(c[h])}else{var e=
(" "+a.className+" ").replace(/[\s+]/," ");h=0;for(g=c.length;h<g;++h)e=e.replace(" "+c[h]+" "," ");a.className=e.trim();return this}}};var e=function(a){return 0<a.offsetHeight?a.offsetHeight+"px":d.css(a,"height")};d.width=function(a,b){return b?(d.css(a,"width",b),this):d.isDisplayNone(a)?d.makeVisibleAndYield(a,function(){return 0<a.offsetWidth?a.offsetWidth+"px":d.css(a,"width")}):0<a.offsetWidth?a.offsetWidth+"px":d.css(a,"width")};d.height=function(a,b){return b?(d.css(a,"height",b),this):
d.isDisplayNone(a)?d.makeVisibleAndYield(a,function(){return e(a)}):e(a)};d.centerElement=function(a,b,c){b||(b=parseInt(d.width(a),10));c||(c=parseInt(d.height(a),10));d.css(a,"margin",-0.5*c+"px 0 0 "+(-0.5*b+"px"));d.addClass(a,"OT_centered")}})(window,window.OTHelpers);
(function(k,d,f){var e={},a={};d.show=function(b){var c=b.style.display;if(""===c||"none"===c)b.style.display=e[b]||"",delete e[b];if("none"===b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue("display")){e[b]="none";c=b.style;if(a[b.ownerDocument]&&a[b.ownerDocument][b.nodeName])b=a[b.ownerDocument][b.nodeName];else{a[b.ownerDocument]||(a[b.ownerDocument]={});var h=b.ownerDocument.createElement(b.nodeName);b.ownerDocument.body.appendChild(h);b=a[b.ownerDocument][b.nodeName]=d.css(h,
"display");d.removeElement(h)}c.display=b}return this};d.hide=function(a){if("none"!==a.style.display)return e[a]=a.style.display,a.style.display="none",this};d.css=function(a,c,d){if("string"!==typeof c){a=a.style;for(var g in c)a[g]=c[g];return this}if(d!==f)return a.style[c]=d,this;c=c.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase();g=a.ownerDocument.defaultView.getComputedStyle(a,null).getPropertyValue(c);""===g&&(g=a.style[c]);return g};d.applyCSS=function(a,c,h){var g={},e;for(e in c)c.hasOwnProperty(e)&&
(g[e]=a.style[e],d.css(a,e,c[e]));h=h();for(e in c)c.hasOwnProperty(e)&&d.css(a,e,g[e]||"");return h};d.makeVisibleAndYield=function(a,c){var h=d.findElementWithDisplayNone(a);if(h)return d.applyCSS(h,{display:"block",visibility:"hidden"},c)}})(window,window.OTHelpers);
(function(k,d,f){function e(a){if("string"===typeof a)return a;var c=[],d;for(d in a)c.push(encodeURIComponent(d)+"\x3d"+encodeURIComponent(a[d]));return c.join("\x26").replace(/\+/g,"%20")}d.getXML=function(a,c){var h=c&&c.success,g=d.extend(c.headers||{},{"Content-Type":"application/xml"});d.get(a,d.extend(c||{},{success:function(a){var b=a.target.responseXML,g;b?(g=b.documentElement,g=!g||!g.nodeName||"parsererror"===g.nodeName?!1:!0):g=!1;g?h&&h(b,a,a.target):c&&c.error&&c.error(a,a.target)},
headers:g}))};d.getJSON=function(a,c){var h=c&&c.success;d.get(a,d.extend(c||{},{success:function(a){var b;try{b=JSON.parse(a.target.responseText)}catch(d){c&&c.error&&c.error(a,a.target);return}h&&h(b,a,a.target)},headers:{"Content-Type":"application/json"}}))};d.get=function(b,c){var d=new XMLHttpRequest,g=c||{};a(d,g.success,g.error);g.process&&d.addEventListener("progress",g.progress,!1);g.cancelled&&d.addEventListener("abort",g.cancelled,!1);d.open("GET",b,!0);g.headers||(g.headers={});for(var e in g.headers)d.setRequestHeader(e,
g.headers[e]);d.send()};d.post=function(b,c){var d=new XMLHttpRequest,g=c||{};a(d,g.success,g.error);g.process&&d.addEventListener("progress",g.progress,!1);g.cancelled&&d.addEventListener("abort",g.cancelled,!1);d.open("POST",b,!0);g.headers||(g.headers={});for(var f in g.headers)d.setRequestHeader(f,g.headers[f]);d.send(e(g.data))};d.postFormData=function(a,c,h){if(!c)throw Error("OTHelpers.postFormData must be passed a data options.");var g=new FormData,e;for(e in c)g.append(e,c[e]);d.post(a,d.extend(h||
{},{data:g}))};d.getJSONP=function(a,c){var h,g=document.head||document.getElementsByTagName("head")[0],e,r=a,m=d.extend(c||{},{callbackParameter:"callback"}),k=function(){e&&(clearTimeout(e),e=null);h&&(h.onload=h.onreadystatechange=null,d.removeElement(h),h=f)},q=function(){if((!h.readyState||/loaded|complete/.test(h.readyState))&&e)clearTimeout(e),e=null};m.callbackName="jsonp_callback_"+ +new Date;this.jsonp_callbacks[m.callbackName]=function(a){k();m.success&&m.success(a)};r+=(/\?/.test(r)?"\x26":
"?")+m.callbackParameter+"\x3d"+m.callbackName;h=d.createElement("script",{async:"async",src:r,onload:q,onreadystatechange:q});g.appendChild(h);e=setTimeout(function(){k();d.error("The JSONP request to "+r+" timed out after 30000ms.");m.error&&m.error("The JSONP request to "+a+" timed out after 30000ms.",r,m)},3E4)};var a=function(a,c,d){a.addEventListener("load",function(a){var b=a.target.status;200<=b&&300>b||304===b?c&&c.apply(null,arguments):d&&d(a)},!1);d&&a.addEventListener("error",d,!1)}})(window,
window.OTHelpers);
!function(){OT.Dialogs={};var k=function(d,a,b){d=d.head||d.getElementsByTagName("head")[0];var c=OT.$.createElement("link",{type:"text/css",media:"screen",rel:"stylesheet",href:a});d.appendChild(c);OT.$.on(c,"error",function(c){OT.error("Could not load CSS for dialog",a,c&&c.message||c)});OT.$.on(c,"load",b)},d=function(d,a,b){a=["//fonts.googleapis.com/css?family\x3dDidact+Gothic",OT.properties.cssURL].concat(a);var c=a.length;OT.$.forEach(a,function(a){k(d,a,function(){0>=--c&&b()})})},f=function(d,
a,b){var c=OT.$.createElement(b||"div",{"class":d},a,this);c.on=function(a,b){OT.$.on(c,a,b);return c};return c};OT.Dialogs.AllowDeny={};OT.Dialogs.AllowDeny.Chrome={};OT.Dialogs.AllowDeny.Firefox={};OT.Dialogs.AllowDeny.Chrome.initialPrompt=function(){var e=new OT.$.Modal(function(a,b){var c=f.bind(b),h,g;h=c("OT_closeButton","\x26times;");h.on("click",function(){e.close()});g=c("OT_root OT_dialog OT_dialog-allow-deny-chrome-first",[h,c("OT_dialog-messages",[c("OT_dialog-messages-main","Allow camera and mic access"),
c("OT_dialog-messages-minor","Click the Allow button in the upper-right corner of your browser to enable real-time communication."),c("OT_dialog-allow-highlight-chrome")])]);d(b,[],function(){b.body.appendChild(g)})});return e};OT.Dialogs.AllowDeny.Chrome.previouslyDenied=function(e){var a=new OT.$.Modal(function(b,c){var h=f.bind(c),g,l;g=h("OT_closeButton","\x26times;").on("click",function(){a.close()});l=h("OT_root OT_dialog OT_dialog-allow-deny-chrome-pre-denied",[g,h("OT_dialog-messages",[h("OT_dialog-messages-main",
"Allow camera and mic access"),h("OT_dialog-messages-minor",["To interact with this app, follow these 3 steps:",h("OT_dialog-3steps",[h("OT_dialog-3steps-step",[h("OT_dialog-3steps-step-num","1"),"Find this icon in the URL bar and click it",h("OT_dialog-allow-camera-icon")]),h("OT_dialog-3steps-seperator"),h("OT_dialog-3steps-step",[h("OT_dialog-3steps-step-num","2"),'Select "Ask if '+e+' wants to access your camera and mic" and then click Done.']),h("OT_dialog-3steps-seperator"),h("OT_dialog-3steps-step",
[h("OT_dialog-3steps-step-num","3"),"Refresh your browser."])])])])]);d(c,[],function(){c.body.appendChild(l)})});return a};OT.Dialogs.AllowDeny.Chrome.deniedNow=function(){return new OT.$.Modal(function(e,a){var b=f.bind(a),c;c=b("OT_root OT_dialog-blackout",b("OT_dialog OT_dialog-allow-deny-chrome-now-denied",[b("OT_dialog-messages",[b("OT_dialog-messages-main ",b("OT_dialog-allow-camera-icon")),b("OT_dialog-messages-minor","Find \x26 click this icon to allow camera and mic access.")])]));d(a,[],
function(){a.body.appendChild(c)})})};OT.Dialogs.AllowDeny.Firefox.maybeDenied=function(){var e=new OT.$.Modal(function(a,b){var c=f.bind(b),h,g;h=c("OT_closeButton","\x26times;").on("click",function(){e.close()});g=c("OT_root OT_dialog OT_dialog-allow-deny-firefox-maybe-denied",[h,c("OT_dialog-messages",[c("OT_dialog-messages-main","Please allow camera \x26 mic access"),c("OT_dialog-messages-minor",["To interact with this app, follow these 3 steps:",c("OT_dialog-3steps",[c("OT_dialog-3steps-step",
[c("OT_dialog-3steps-step-num","1"),"Reload the page, or click the camera icon in the browser URL bar."]),c("OT_dialog-3steps-seperator"),c("OT_dialog-3steps-step",[c("OT_dialog-3steps-step-num","2"),"In the menu, select your camera \x26 mic."]),c("OT_dialog-3steps-seperator"),c("OT_dialog-3steps-step",[c("OT_dialog-3steps-step-num","3"),'Click "Share Selected Devices."'])])])])]);d(b,[],function(){b.body.appendChild(g)})});return e};OT.Dialogs.AllowDeny.Firefox.denied=function(){var e=new OT.$.Modal(function(a,
b){var c=f.bind(b),h,g;g=f.bind(b,"OT_dialog-button OT_dialog-button-large")("Reload").on("click",function(){e.trigger("refresh")});h=c("OT_root OT_dialog-blackout",c("OT_dialog OT_dialog-allow-deny-firefox-denied",[c("OT_dialog-messages",[c("OT_dialog-messages-minor","Access to camera and microphone has been denied. Click the button to reload page.")]),c("OT_dialog-single-button",g)]));d(b,[],function(){b.body.appendChild(h)})});return e}}();
!function(k){k.OT||(k.OT={});OT.$=OTHelpers.noConflict();OT.$.eventing(OT);OT.$.useLogHelpers(OT);var d=!1,f=OT.setLogLevel;OT.setLogLevel=function(e){OT.$.setLogLevel(e);e=f.call(OT,e);OT.shouldLog(OT.DEBUG)&&!d&&(OT.debug("OpenTok JavaScript library "+OT.properties.version),OT.debug("Release notes: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html"),OT.debug("Known issues: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues"),d=!0);OT.debug("TB.setLogLevel("+
e+")");return e};OT.setLogLevel(OT.properties.debug?OT.DEBUG:OT.ERROR)}(window);
(function(k){k.OT||(k.OT={});if(!OT.properties)throw Error("OT.properties does not exist, please ensure that you include a valid properties file.");var d=OT,f=OT.properties,e=OT.$.clone(f);e.debug="true"===f.debug||!0===f.debug;e.supportSSL="true"===f.supportSSL||!0===f.supportSSL;e.supportSSL&&(0<=k.location.protocol.indexOf("https")||0<=k.location.protocol.indexOf("chrome-extension"))?(e.assetURL=e.cdnURLSSL+"/webrtc/"+e.version,e.loggingURL=e.loggingURLSSL):e.assetURL=e.cdnURL+"/webrtc/"+e.version;
e.configURL=e.assetURL+"/js/dynamic_config.min.js";e.cssURL=e.assetURL+"/css/ot.min.css";d.properties=e})(window);
(function(k){OT.Config=function(){var d=!1,f={},e={},a,b=document.head||document.getElementsByTagName("head")[0],c,h=function(){c&&(clearTimeout(c),c=null);a&&(a.onload=a.onreadystatechange=null,b&&a.parentNode&&b.removeChild(a),a=void 0)},g=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))c&&(clearTimeout(c),c=null),d||l._onLoadTimeout()},l={loadTimeout:4E3,load:function(h){if(!h)throw Error("You must pass a valid configUrl to Config.load");d=!1;setTimeout(function(){a=document.createElement("script");
a.async="async";a.src=h;a.onload=a.onreadystatechange=g.bind(this);b.appendChild(a)},1);c=setTimeout(function(){l._onLoadTimeout()},this.loadTimeout)},_onLoadTimeout:function(){h();OT.warn("TB DynamicConfig failed to load in "+l.loadTimeout+" ms");this.trigger("dynamicConfigLoadFailed")},isLoaded:function(){return d},reset:function(){h();d=!1;f={};e={}},replaceWith:function(a){h();a||(a={});f=a.global||{};e=a.partners||{};d||(d=!0);this.trigger("dynamicConfigChanged")},get:function(a,c,b){a=b&&e[b]&&
e[b][a]?e[b][a]:f[a];return a?a[c]:null}};OT.$.eventing(l);return l}()})(window);
(function(k){function d(a,b,c,d,g){b=b?parseInt(b,10):parseInt(OT.$.width(a.parentNode),10);c=c?parseInt(c,10):parseInt(OT.$.height(a.parentNode),10);if(!(0===b||0===c))if(d||(d=f),c=(b+0)/c,b={width:"100%",height:"100%",left:0,top:0},c>d?(d=100*(c/d),b.height=d+"%",b.top="-"+(d-100)/2+"%"):c<d&&(d=100*(d/c),b.width=d+"%",b.left="-"+(d-100)/2+"%"),OT.$.css(a,b),d=a.querySelector("video"))g?(g=a.offsetWidth,a=a.offsetHeight,b={width:a+"px",height:g+"px",marginTop:"",marginLeft:""},a=g-a,b.marginLeft=
a/2+"px",b.marginTop=-(a/2)+"px",OT.$.css(d,b)):OT.$.css(d,{width:"",height:"",marginTop:"",marginLeft:""})}var f=4/3,e=function(a,b){var c,d;a&&a.nodeName?(c=a,(!c.getAttribute("id")||0===c.getAttribute("id").length)&&c.setAttribute("id","OT_"+OT.$.uuid()),d=c.getAttribute("id")):(c=OT.$(a),d=a||"OT_"+OT.$.uuid());c?OT.$.emptyElement(c):(c=OT.$.createElement("div",{id:d}),c.style.backgroundColor="#000000",document.body.appendChild(c));null==b||"replace"==b||(d=document.createElement("div"),d.id=
"OT_"+OT.$.uuid(),"append"==b?(c.appendChild(d),c=d):"before"==b?(c.parentNode.insertBefore(d,c),c=d):"after"==b&&(c.parentNode.insertBefore(d,c.nextSibling),c=d));return c};OT.WidgetView=function(a,b){var c=e(a,b&&b.insertMode),h=document.createElement("div"),g,f,r,m,k,q=!0;b&&(width=b.width,height=b.height,width&&"number"==typeof width&&(width+="px"),height&&"number"==typeof height&&(height+="px"),c.style.width=width?width:"894px",c.style.height=height?height:"598px",c.style.overflow="hidden",(void 0===
b.mirror||b.mirror)&&OT.$.addClass(c,"OT_mirrored"));b.classNames&&OT.$.addClass(c,b.classNames);OT.$.addClass(c,"OT_loading");OT.$.addClass(h,"OT_video-container");h.style.width=c.style.width;h.style.height=c.style.height;c.appendChild(h);d(h,c.offsetWidth,c.offsetHeight);k=document.createElement("div");OT.$.addClass(k,"OT_video-loading");h.appendChild(k);m=document.createElement("div");OT.$.addClass(m,"OT_video-poster");h.appendChild(m);g=OT.$.observeStyleChanges(c,["width","height"],function(a){d(h,
a.width?a.width[1]:c.offsetWidth,a.height?a.height[1]:c.offsetHeight,f?f.aspectRatio:null)});r=OT.$.observeNodeOrChildNodeRemoval(c,function(a){f&&(a.some(function(a){return a===h||"VIDEO"===a.nodeName})&&(f.destroy(),f=null),h&&(OT.$.removeElement(h),h=null),g&&(g.disconnect(),g=null),r&&(r.disconnect(),r=null))});this.destroy=function(){g&&(g.disconnect(),g=null);r&&(r.disconnect(),r=null);f&&(f.destroy(),f=null);c&&(OT.$.removeElement(c),c=null)};Object.defineProperties(this,{showPoster:{get:function(){return!OT.$.isDisplayNone(m)},
set:function(a){a?OT.$.show(m):OT.$.hide(m)}},poster:{get:function(){return OT.$.css(m,"backgroundImage")},set:function(a){OT.$.css(m,"backgroundImage","url("+a+")")}},loading:{get:function(){return q},set:function(a){(q=a)?OT.$.addClass(c,"OT_loading"):OT.$.removeClass(c,"OT_loading")}},video:{get:function(){return f},set:function(a){f&&f.destroy();a.appendTo(h);f=a;f.on({orientationChanged:function(){d(h,c.offsetWidth,c.offsetHeight,f.aspectRatio,f.isRotated)}});d(h,c.offsetWidth,c.offsetHeight,
f?f.aspectRatio:null,f?f.isRotated:null)}},domElement:{get:function(){return c}},domId:{get:function(){return c.getAttribute("id")}}});this.addError=function(a,b,g){c.innerHTML="\x3cp\x3e"+a+(b?' \x3cspan class\x3d"ot-help-message"\x3e'+b+"\x3c/span\x3e":"")+"\x3c/p\x3e";OT.$.addClass(c,g||"OT_subscriber_error");c.querySelector("p").offsetHeight>c.offsetHeight&&(c.querySelector("span").style.display="none")}}})(window);
(function(k){var d=function(){if(navigator.getUserMedia)return navigator.getUserMedia.bind(navigator);if(navigator.mozGetUserMedia)return navigator.mozGetUserMedia.bind(navigator);if(navigator.webkitGetUserMedia)return navigator.webkitGetUserMedia.bind(navigator)}();navigator.webkitGetUserMedia?(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=
function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),webkitRTCPeerConnection.prototype.getRemoteStreams||(webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=
function(){return[]}));var f={PERMISSION_DENIED:"PermissionDeniedError",NOT_SUPPORTED_ERROR:"NotSupportedError",MANDATORY_UNSATISFIED_ERROR:" ConstraintNotSatisfiedError",NO_DEVICES_FOUND:"NoDevicesFoundError",HARDWARE_UNAVAILABLE:"HardwareUnavailableError"},e={1:"PermissionDeniedError"},a={PermissionDeniedError:"End-user denied permission to hardware devices",NotSupportedError:"A constraint specified is not supported by the browser.",ConstraintNotSatisfiedError:"It's not possible to satisfy one or more constraints passed into the getUserMedia function",
OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NoDevicesFoundError:"No voice or video input devices are available on this machine.",HardwareUnavailableError:"The selected voice or video devices are unavailable. Verify that the chosen devices are not in use by another application."},b=function(c,b){var d=b[c],e=a[d];e||(e=eventName,d=c);return{name:d,message:e}},c=function(c){var d;OT.$.isObject(c)&&c.name?d={name:c.name,message:c.message||
a[c.name],constraintName:c.constraintName}:OT.$.isObject(c)?(d=b(c.code,e),c.message&&(d.message=c.message),c.constraintName&&(d.constraintName=c.constraintName)):d=c&&f.hasOwnProperty(c)?b(c,f):{message:"Unknown Error while getting user media"};return d},h=function(a){if(!a||!OT.$.isObject(a))return!0;for(var c in a)if(a[c])return!1;return!0};OT.$.supportsWebRTC=function(){var a=!1,c=OT.$.browserVersion(),b=(OT.properties.minimumVersion||{})[c.browser.toLowerCase()];if(b&&b>c.version)OT.debug("Support for",
c.browser,"is disabled because we require",b,"but this is",c.version),a=!1;else if(navigator.webkitGetUserMedia)a="function"===typeof webkitRTCPeerConnection&&!!webkitRTCPeerConnection.prototype.addStream;else if(navigator.mozGetUserMedia&&"function"===typeof mozRTCPeerConnection&&20<c.version)try{new mozRTCPeerConnection,a=!0}catch(d){a=!1}OT.$.supportsWebRTC=function(){return a};return a};OT.$.supportedCryptoScheme=function(){if(!OT.$.supportsWebRTC())return"NONE";var a=k.navigator.userAgent.toLowerCase().match(/chrome\/([0-9\.]+)/i);
return a&&25>parseFloat(a[1],10)?"SDES_SRTP":"DTLS_SRTP"};OT.$.supportsBundle=function(){return OT.$.supportsWebRTC()&&"Chrome"===OT.$.browser()};OT.$.supportsRtcpMux=function(){return OT.$.supportsWebRTC()&&"Chrome"===OT.$.browser()};OT.$.shouldAskForDevices=function(a){var c=function(c,b){OT.$.shouldAskForDevices=function(a){setTimeout(a.bind(null,{video:b,audio:c}))};OT.$.shouldAskForDevices(a)},b=k.MediaStreamTrack;null!=b&&OT.$.isFunction(b.getSources)?k.MediaStreamTrack.getSources(function(a){var b=
a.some(function(a){return"audio"===a.kind});a=a.some(function(a){return"video"===a.kind});c(b,a)}):c(!0,!0)};OT.$.getUserMedia=function(b,e,f,m,p,q,s){var n=d;OT.$.isFunction(s)&&(n=s);if(h(b))OT.error("Couldn't get UserMedia: All constraints were false"),f.call(null,{name:"NO_VALID_CONSTRAINTS",message:"Video and Audio was disabled, you need to enabled at least one"});else{var y=null,w=!1;s=function(){y=null;w=!0;m&&m()};var u=function(a){y&&clearTimeout(y);w&&p&&p();e.call(null,a)},v=function(b){y&&
clearTimeout(y);w&&p&&p();var d=c(b);"PermissionDeniedError"===d.name?(b=k.MediaStreamTrack,null!=b&&OT.$.isFunction(b.getSources)?k.MediaStreamTrack.getSources(function(c){0<c.length?q.call(null,d):f.call(null,{name:"NoDevicesFoundError",message:a.NoDevicesFoundError})}):q.call(null,d)):f.call(null,d)};try{n(b,u,v)}catch(x){OT.error("Couldn't get UserMedia: "+x.toString());v();return}y=-1===location.protocol.indexOf("https")?setTimeout(s,100):setTimeout(s,500)}};OT.$.createPeerConnection=function(a,
c){return new (k.webkitRTCPeerConnection||k.mozRTCPeerConnection)(a,c)}})(window);
(function(k){function d(a,b){var d=document.createElement("video");d.setAttribute("autoplay","");d.innerHTML=a;if(b){!0===b.muted&&(delete b.muted,d.muted="true");for(var e in b)d.setAttribute(e,b[e])}return d}function f(a){return b[parseInt(a,10)]||"An unknown error occurred."}function e(a,b,d,e){if(navigator.mozGetUserMedia||0<b.getVideoTracks().length&&b.getVideoTracks()[0].enabled){var r=function(){clearTimeout(q);a.removeEventListener("loadedmetadata",m,!1);a.removeEventListener("error",p,!1)},
m=function(a){r();d()},p=function(a){r();e("There was an unexpected problem with the Video Stream: "+f(a.target.error.code))},q=setTimeout(function(){0===a.currentTime?e("The video stream failed to connect. Please notify the site owner if this continues to happen."):(OT.warn("Never got the loadedmetadata event but currentTime \x3e 0"),d())}.bind(this),3E4);a.addEventListener("loadedmetadata",m,!1);a.addEventListener("error",p,!1);b.onended=function(){r();e("Stream ended while trying to bind it to a video element.")}}else d();
void 0!==a.srcObject?a.srcObject=b:void 0!==a.mozSrcObject?a.mozSrcObject=b:a.src=k.URL.createObjectURL(b);a.play()}OT.VideoOrientation={ROTATED_NORMAL:"OTVideoOrientationRotatedNormal",ROTATED_LEFT:"OTVideoOrientationRotatedLeft",ROTATED_RIGHT:"OTVideoOrientationRotatedRight",ROTATED_UPSIDE_DOWN:"OTVideoOrientationRotatedUpsideDown"};OT.VideoElement=function(a){var b,g,l,r=!1,m=!1;a=OT.$.defaults(a||{},{fallbackText:"Sorry, Web RTC is not available in your browser"});OT.$.eventing(this);var p=function(a){a=
"There was an unexpected problem with the Video Stream: "+f(a.target.error.code);this.trigger("error",null,a,this)}.bind(this),q=function(){r=!0;g.addEventListener("error",p,!1);this.trigger("streamBound",this)}.bind(this),s=function(a){this.trigger("loadError",OT.ExceptionCodes.P2P_CONNECTION_FAILED,a,this)}.bind(this),n=function(){m||(OT.warn("Video element paused, auto-resuming. If you intended to do this, use publishVideo(false) or subscribeToVideo(false) instead."),m=!0);g.play()};g=d(a.fallbackText,
a.attributes);g.addEventListener("pause",n);Object.defineProperties(this,{stream:{get:function(){return b}},domElement:{get:function(){return g}},parentElement:{get:function(){return l}},isBoundToStream:{get:function(){return r}},poster:{get:function(){return g.getAttribute("poster")},set:function(a){g.setAttribute("poster",a)}}});this.appendTo=function(a){l=a;l.appendChild(g);return this};this.bindToStream=function(a){r=!1;b=a;e(g,b,q,s);return this};this.unbindStream=function(){if(!b)return this;
g&&(navigator.mozGetUserMedia?g.mozSrcObject=null:k.URL.revokeObjectURL(g.src));b=null;return this};this.setAudioVolume=function(a){g&&(g.volume=OT.$.roundFloat(a/100,2))};this.getAudioVolume=function(){return g?parseInt(100*g.volume,10):50};this.whenTimeIncrements=function(a,b){if(g){var c,d=function(){!c||c>=g.currentTime?c=g.currentTime:(g.removeEventListener("timeupdate",d,!1),a.call(b,this))}.bind(this);g.addEventListener("timeupdate",d,!1)}};this.destroy=function(){this.off();this.unbindStream();
g&&(g.removeEventListener("pause",n),OT.$.removeElement(g),g=null);l=null}};OT.$.canDefineProperty&&Object.defineProperties(OT.VideoElement.prototype,{imgData:{get:function(){var a=OT.$.createElement("canvas",{width:this.domElement.videoWidth,height:this.domElement.videoHeight,style:{display:"none"}});document.body.appendChild(a);try{a.getContext("2d").drawImage(this.domElement,0,0,a.width,a.height)}catch(b){return OT.warn("Cannot get image data yet"),null}var d=a.toDataURL("image/png");OT.$.removeElement(a);
return d.replace("data:image/png;base64,","").trim()}},videoWidth:{get:function(){return this._orientation&&this._orientation.width?this._orientation.width:this.domElement["video"+(this.isRotated?"Height":"Width")]}},videoHeight:{get:function(){return this._orientation&&this._orientation.height?this._orientation.height:this.domElement["video"+(this.isRotated?"Width":"Height")]}},aspectRatio:{get:function(){return(this.videoWidth+0)/this.videoHeight}},isRotated:{get:function(){return this._orientation&&
("OTVideoOrientationRotatedLeft"==this._orientation.videoOrientation||"OTVideoOrientationRotatedRight"==this._orientation.videoOrientation)}}});var a={OTVideoOrientationRotatedNormal:"rotate(0deg)",OTVideoOrientationRotatedLeft:"rotate(90deg)",OTVideoOrientationRotatedRight:"rotate(-90deg)",OTVideoOrientationRotatedUpsideDown:"rotate(180deg)"};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"orientation",{get:function(){return this._orientation},set:function(b){this._orientation=
b;b=a[b.videoOrientation]||a.ROTATED_NORMAL;switch(OT.$.browser()){case "Chrome":case "Safari":this.domElement.style.webkitTransform=b;break;case "IE":this.domElement.style.msTransform=b;break;default:this.domElement.style.transform=b}this.trigger("orientationChanged")}});var b={};k.MediaError&&(b[k.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",b[k.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",
b[k.MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be usable.",b[k.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable. ")})(window);
(function(k){var d=[],f=!1;OT.Analytics=function(){var e=OT.properties.loggingURL+"/logging/ClientEvent",a=OT.properties.loggingURL+"/logging/ClientQos",b={},c={payloadType:"payload_type",partnerId:"partner_id",streamId:"stream_id",sessionId:"session_id",connectionId:"connection_id",widgetType:"widget_type",widgetId:"widget_id",avgAudioBitrate:"avg_audio_bitrate",avgVideoBitrate:"avg_video_bitrate",localCandidateType:"local_candidate_type",remoteCandidateType:"remote_candidate_type",transportType:"transport_type"},
h=function(b,c,d,g){OT.$.post(c?a:e,{success:d,error:g,data:b,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},g=function(){if(!f&&0<d.length){f=!0;var a=d[0],b=function(){d.shift();f=!1;g()};a&&h(a.data,a.isQos,function(){a.onComplete();setTimeout(b,50)},function(){OT.debug("Failed to send ClientEvent, moving on to the next item.");setTimeout(b,50)})}};this.logError=function(a,c,d,g,e){e||(e={});d=e.partnerId;if(!0===OT.Config.get("exceptionLogging","enabled",d)){var f;d?(f=[d,c,a].join("_"),
f=100>=(b[f]||0)):f=!1;if(!f){d=[d,c,a].join("_");var h=this.escapePayload(OT.$.extend(g||{},{message:h,userAgent:navigator.userAgent}));b[d]="undefined"!==typeof b[d]?b[d]+1:1;return this.logEvent(OT.$.extend(e,{action:c+"."+a,payloadType:h[0],payload:h[1]}))}}};this.logEvent=function(a){var b=a.partnerId;a||(a={});a=OT.$.extend({variation:"",guid:this.getClientGuid(),widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:b,source:k.location.href,section:"",build:""},a);for(var e in c)c.hasOwnProperty(e)&&
a[e]&&(a[c[e]]=a[e],delete a[e]);d.push({data:a,onComplete:function(){},isQos:!1});g()};this.logQOS=function(a){var b=a.partnerId;a||(a={});a=OT.$.extend({guid:this.getClientGuid(),widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:b,source:k.location.href,build:"",duration:0},a);for(var e in c)c.hasOwnProperty(e)&&a[e]&&(a[c[e]]=a[e],delete a[e]);d.push({data:a,onComplete:function(){},isQos:!0});g()};this.escapePayload=function(a){var b=[],c=[],d;for(d in a)a.hasOwnProperty(d)&&
(null!==a[d]&&void 0!==a[d])&&(b.push(a[d]?a[d].toString().replace("|","\\|"):""),c.push(d.toString().replace("|","\\|")));return[c.join("|"),b.join("|")]};this.getClientGuid=function(){var a=OT.$.getCookie("opentok_client_id");a||(a=OT.$.uuid(),OT.$.setCookie("opentok_client_id",a));this.getClientGuid=function(){return a};return a}}})(window);
(function(k){"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");k.OT||(k.OT={});!k.URL&&k.webkitURL&&(k.URL=k.webkitURL);var d,f=document.location.hash;OT.initSession=function(d){var a=OT.sessions.get(d);a||(a=new OT.Session(d),OT.sessions.add(a));return a};OT.initPublisher=function(d,a,b,c){OT.debug("TB.initPublisher("+a+")");var f=new OT.Publisher;OT.publishers.add(f);c&&OT.$.isFunction(c)&&
(d=function l(a){f.off("initSuccess",l);f.off("publishComplete",l);c.apply(null,arguments)},f.once("initSuccess",d),f.once("publishComplete",d));f.publish(a,b);return f};OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");var d=OT.$.supportsWebSockets()&&OT.$.supportsWebRTC()?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS;OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");return d};return d};OT.upgradeSystemRequirements=function(){OT.onLoad(function(){document.body.appendChild(function(){var d=
document.createElement("iframe");d.id="_upgradeFlash";d.style.position="absolute";d.style.position="fixed";d.style.height="100%";d.style.width="100%";d.style.top="0px";d.style.left="0px";d.style.right="0px";d.style.bottom="0px";d.style.zIndex=1E3;try{d.style.backgroundColor="rgba(0,0,0,0.2)"}catch(a){d.style.backgroundColor="transparent",d.setAttribute("allowTransparency","true")}d.setAttribute("frameBorder","0");d.frameBorder="0";d.scrolling="no";d.setAttribute("scrolling","no");var b=OT.$.browserVersion(),
b=OT.properties.minimumVersion[b.browser.toLowerCase()];d.src=OT.properties.assetURL+"/html/upgrade.html#"+encodeURIComponent(b?"true":"false")+","+encodeURIComponent(JSON.stringify(OT.properties.minimumVersion))+"|"+encodeURIComponent(document.location.href);return d}());d&&clearInterval(d);d=setInterval(function(){var d=document.location.hash,a=/^#?\d+&/;d!==f&&a.test(d)&&(f=d,"close_window"===d.replace(a,"")&&(document.body.removeChild(document.getElementById("_upgradeFlash")),document.location.hash=
""))},100)})};OT.reportIssue=function(){OT.warn("ToDo: haven't yet implemented TB.reportIssue")};OT.components={};OT.sessions={};OT.rtc={};OT.APIKEY=function(){var d=document.getElementsByTagName("script"),d=d[d.length-1],d=d.getAttribute("src")||d.src;return(d=d.match(/[\?\&]apikey=([^&]+)/i))?d[1]:""}();OT.HAS_REQUIREMENTS=1;OT.NOT_HAS_REQUIREMENTS=0;k.OT||(k.OT=OT);k.TB||(k.TB=OT)})(window);
(function(k){OT.Collection=function(d){var f=[],e={},a=d||"id";OT.$.eventing(this,!0);var b=function(a){this.trigger("update",a);this.trigger("update:"+a.target.id,a)}.bind(this),c=function(a,b){if(void 0!==e[a]){var c=e[a];delete e[a];e[b]=c}}.bind(this),h=function(a){this.remove(a.target,a.reason)}.bind(this);this.reset=function(){f.forEach(function(a){a.off("updated",b,this);a.off("destroyed",h,this);a.off("idUpdated",c,this)},this);f=[];e={}};this.destroy=function(){f.forEach(function(a){a.destroy(void 0,
!0)});this.reset();this.off()};this.get=function(a){return a&&void 0!==e[a]?f[e[a]]:void 0};this.has=function(a){return a&&void 0!==e[a]};this.toString=function(){return f.toString()};this.where=function(a,b){return OT.$.isFunction(a)?f.filter(a,b):f.filter(function(b){for(var c in a)if(b[c]!==a[c])return!1;return!0})};this.find=function(a,b){var c;c=OT.$.isFunction(a)?a:function(b){for(var c in a)if(b[c]!==a[c])return!1;return!0};c=c.bind(b);for(var d=0;d<f.length;++d)if(!0===c(f[d]))return f[d];
return null};this.add=function(d){var l=d[a];if(this.has(l))return OT.warn("Model "+l+" is already in the collection",f),this;e[l]=f.push(d)-1;d.on("updated",b,this);d.on("destroyed",h,this);d.on("idUpdated",c,this);this.trigger("add",d);this.trigger("add:"+l,d);return this};this.remove=function(d,l){var k=d[a];f.splice(e[k],1);for(var m=e[k];m<f.length;++m)e[f[m][a]]=m;delete e[k];d.off("updated",b,this);d.off("destroyed",h,this);d.off("idUpdated",c,this);this.trigger("remove",d,l);this.trigger("remove:"+
k,d,l);return this};OT.$.defineGetters(this,{length:function(){return f.length}})}})(this);
(function(k){OT.Event=OT.$.eventing.Event();OT.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",
MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",PUBLISHER_DESTROYED:"destroyed",SUBSCRIBER_DESTROYED:"destroyed",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",
CLOSE_BUTTON_CLICK:"closeButtonClick",MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded"};OT.ValueEvent=function(d,f){OT.Event.call(this,d);this.value=f};OT.ExceptionCodes={JS_EXCEPTION:2E3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,NOT_CONNECTED:1010,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SIGNAL:1510,UNABLE_TO_FORCE_DISCONNECT:1520,
UNABLE_TO_FORCE_UNPUBLISH:1530};OT.ExceptionEvent=function(d,f,e,a,b,c){OT.Event.call(this,d);this.message=f;this.title=e;this.code=a;this.component=b;this.target=c};OT.IssueReportedEvent=function(d,f){OT.Event.call(this,d);this.issueId=f};OT.EnvLoadedEvent=function(d){OT.Event.call(this,d)};OT.ConnectionEvent=function(d,f,e){OT.Event.call(this,d);this.connections=f;this.reason=e};OT.StreamEvent=function(d,f,e,a){OT.Event.call(this,d,a);this.streams=f;this.reason=e};OT.SessionConnectEvent=function(d,
f,e,a){OT.Event.call(this,d);this.connections=f;this.streams=e;this.archives=a;this.groups=[]};OT.SessionDisconnectEvent=function(d,f,e){OT.Event.call(this,d,e);this.reason=f};OT.VolumeEvent=function(d,f,e){OT.Event.call(this,d);this.streamId=f;this.volume=e};OT.DeviceEvent=function(d,f,e){OT.Event.call(this,d);this.camera=f;this.microphone=e};OT.DeviceStatusEvent=function(d,f,e,a,b){OT.Event.call(this,d);this.cameras=f;this.microphones=e;this.selectedCamera=a;this.selectedMicrophone=b};OT.ResizeEvent=
function(d,f,e,a,b){OT.Event.call(this,d);this.widthFrom=f;this.widthTo=e;this.heightFrom=a;this.heightTo=b};OT.StreamPropertyChangedEvent=function(d,f,e,a,b){OT.Event.call(this,d);this.type=d;this.stream=f;this.changedProperty=e;this.oldValue=a;this.newValue=b};OT.ArchiveEvent=function(d,f){OT.Event.call(this,d);this.archives=f};OT.ArchiveStreamEvent=function(d,f,e){OT.Event.call(this,d);this.archive=f;this.streams=e};OT.StateChangedEvent=function(d,f){OT.Event.call(this,d);this.changedValues=f};
OT.ChangeFailedEvent=function(d,f,e,a){OT.Event.call(this,d);this.reasonCode=f;this.reason=e;this.failedValues=a};OT.SignalEvent=function(d,f,e){OT.Event.call(this,d?"signal:"+d:OT.Event.names.SIGNAL,!1);this.data=f;this.from=e};OT.StreamUpdatedEvent=function(d,f,e,a){OT.Event.call(this,"updated");this.target=d;this.changedProperty=f;this.oldValue=e;this.newValue=a};OT.DestroyedEvent=function(d,f,e){OT.Event.call(this,d,!1);this.target=f;this.reason=e}})(window);
(function(k){function d(a,b,c){return b<=a&&a<=c}function f(a,b){return Math.floor(a/b)}function e(a){var b=0;this.get=function(){return b>=a.length?-1:Number(a[b])};this.offset=function(c){b+=c;if(0>b)throw Error("Seeking past start of the buffer");if(b>a.length)throw Error("Seeking past EOF");};this.match=function(c){if(c.length>b+a.length)return!1;var d;for(d=0;d<c.length;d+=1)if(Number(a[b+d])!==c[d])return!1;return!0}}function a(a){var b=0;this.emit=function(c){var d=-1,g;for(g=0;g<arguments.length;++g)d=
Number(arguments[g]),a[b++]=d;return d}}function b(a){var b=0,c=function(a){for(var b=[],c=0,g=a.length;c<a.length;){var f=a.charCodeAt(c);if(d(f,55296,57343))if(d(f,56320,57343))b.push(65533);else if(c===g-1)b.push(65533);else{var e=a.charCodeAt(c+1);d(e,56320,57343)?(f&=1023,e&=1023,c+=1,b.push(65536+(f<<10)+e)):b.push(65533)}else b.push(f);c+=1}return b}(a);this.offset=function(a){b+=a;if(0>b)throw Error("Seeking past start of the buffer");if(b>c.length)throw Error("Seeking past EOF");};this.get=
function(){return b>=c.length?-1:c[b]}}function c(){var a="";this.string=function(){return a};this.emit=function(b){65535>=b?a+=String.fromCharCode(b):(b-=65536,a+=String.fromCharCode(55296+(b>>10&1023)),a+=String.fromCharCode(56320+(b&1023)))}}function h(a){this.name="EncodingError";this.message=a;this.code=0}function g(a,b){if(a)throw new h("Decoder error");return b||65533}function l(a){throw new h("The code point "+a+" could not be encoded.");}function r(a){a=String(a).trim().toLowerCase();return Object.prototype.hasOwnProperty.call(J,
a)?J[a]:null}function m(a,b){return(b||[])[a]||null}function p(a,b){var c=b.indexOf(a);return-1===c?null:c}function q(a){var b=a.fatal,c=0,f=0,e=0,h=0;this.decode=function(a){var l=a.get();if(-1===l)return 0!==f?g(b):-1;a.offset(1);if(0===f){if(d(l,0,127))return l;if(d(l,194,223))f=1,h=128,c=l-192;else if(d(l,224,239))f=2,h=2048,c=l-224;else if(d(l,240,244))f=3,h=65536,c=l-240;else return g(b);c*=Math.pow(64,f);return null}if(!d(l,128,191))return h=e=f=c=0,a.offset(-1),g(b);e+=1;c+=(l-128)*Math.pow(64,
f-e);if(e!==f)return null;a=c;l=h;h=e=f=c=0;return d(a,l,1114111)&&!d(a,55296,57343)?a:g(b)}}function s(a){this.encode=function(a,b){var c=b.get();if(-1===c)return-1;b.offset(1);if(d(c,55296,57343))return l(c);if(d(c,0,127))return a.emit(c);var g,e;d(c,128,2047)?(g=1,e=192):d(c,2048,65535)?(g=2,e=224):d(c,65536,1114111)&&(g=3,e=240);for(e=a.emit(f(c,Math.pow(64,g))+e);0<g;)e=f(c,Math.pow(64,g-1)),e=a.emit(128+e%64),g-=1;return e}}function n(a,b){var c=b.fatal;this.decode=function(b){var f=b.get();
if(-1===f)return-1;b.offset(1);if(d(f,0,127))return f;b=a[f-128];return null===b?g(c):b}}function y(a,b){this.encode=function(b,c){var g=c.get();if(-1===g)return-1;c.offset(1);if(d(g,0,127))return b.emit(g);var f=p(g,a);null===f&&l(g);return b.emit(f+128)}}function w(a,b){var c=b.fatal,f=0,e=0,h=0;this.decode=function(b){var l=b.get();if(-1===l&&0===f&&0===e&&0===h)return-1;if(-1===l&&(0!==f||0!==e||0!==h))h=e=f=0,g(c);b.offset(1);var t;if(0!==h){t=null;if(d(l,48,57))if(l=10*(126*(10*(f-129)+(e-48))+
(h-129))+l-48,39419<l&&189E3>l||1237575<l)t=null;else{var k=0;t=0;var C=A.gb18030,r;for(r=0;r<C.length;++r){var P=C[r];if(P[0]<=l)k=P[0],t=P[1];else break}t=t+l-k}h=e=f=0;return null===t?(b.offset(-3),g(c)):t}if(0!==e){if(d(l,129,254))return h=l,null;b.offset(-2);e=f=0;return g(c)}if(0!==f){if(d(l,48,57)&&a)return e=l,null;t=f;k=null;f=0;C=127>l?64:65;if(d(l,64,126)||d(l,128,254))k=190*(t-129)+(l-C);t=null===k?null:m(k,A.gbk);null===k&&b.offset(-1);return null===t?g(c):t}return d(l,0,127)?l:128===
l?8364:d(l,129,254)?(f=l,null):g(c)}}function u(a,b){this.encode=function(b,c){var g=c.get();if(-1===g)return-1;c.offset(1);if(d(g,0,127))return b.emit(g);var e=p(g,A.gbk);if(null!==e)return g=f(e,190)+129,e%=190,b.emit(g,e+(63>e?64:65));if(null===e&&!a)return l(g);var h=e=0,m=A.gb18030,t;for(t=0;t<m.length;++t){var k=m[t];if(k[1]<=g)e=k[1],h=k[0];else break}e=h+g-e;g=f(f(f(e,10),126),10);e-=12600*g;h=f(f(e,10),126);e-=1260*h;m=f(e,10);return b.emit(g+129,h+48,m+129,e-10*m+48)}}function v(a){var b=
a.fatal,c=!1,f=0;this.decode=function(a){var e=a.get();if(-1===e&&0===f)return-1;if(-1===e&&0!==f)return f=0,g(b);a.offset(1);if(126===f){f=0;if(123===e)return c=!0,null;if(125===e)return c=!1,null;if(126===e)return 126;if(10===e)return null;a.offset(-1);return g(b)}if(0!==f){a=f;f=0;var h=null;d(e,33,126)&&(h=m(190*(a-1)+(e+63),A.gbk));10===e&&(c=!1);return null===h?g(b):h}if(126===e)return f=126,null;if(c){if(d(e,32,127))return f=e,null;10===e&&(c=!1);return g(b)}return d(e,0,127)?e:g(b)}}function x(a){var b=
!1;this.encode=function(a,c){var g=c.get();if(-1===g)return-1;c.offset(1);if(d(g,0,127)&&b)return c.offset(-1),b=!1,a.emit(126,125);if(126===g)return a.emit(126,126);if(d(g,0,127))return a.emit(g);if(!b)return c.offset(-1),b=!0,a.emit(126,123);var e=p(g,A.gbk);if(null===e)return l(g);var h=f(e,190)+1,e=e%190-63;return!d(h,33,126)||!d(e,33,126)?l(g):a.emit(h,e)}}function B(a){var b=a.fatal,c=0,e=null;this.decode=function(a){if(null!==e)return a=e,e=null,a;var f=a.get();if(-1===f&&0===c)return-1;if(-1===
f&&0!==c)return c=0,g(b);a.offset(1);if(0!==c){var h=c,l=null;c=0;var t=127>f?64:98;if(d(f,64,126)||d(f,161,254))l=157*(h-129)+(f-t);if(1133===l)return e=772,202;if(1135===l)return e=780,202;if(1164===l)return e=772,234;if(1166===l)return e=780,234;f=null===l?null:m(l,A.big5);null===l&&a.offset(-1);return null===f?g(b):f}return d(f,0,127)?f:d(f,129,254)?(c=f,null):g(b)}}function E(a){this.encode=function(a,b){var c=b.get();if(-1===c)return-1;b.offset(1);if(d(c,0,127))return a.emit(c);var g=p(c,A.big5);
if(null===g)return l(c);c=f(g,157)+129;g%=157;return a.emit(c,g+(63>g?64:98))}}function G(a){var b=a.fatal,c=0,e=0;this.decode=function(a){var f=a.get();if(-1===f){if(0===c&&0===e)return-1;e=c=0;return g(b)}a.offset(1);var h,l;return 0!==e?(h=e,e=0,l=null,d(h,161,254)&&d(f,161,254)&&(l=m(94*(h-161)+f-161,A.jis0212)),d(f,161,254)||a.offset(-1),null===l?g(b):l):142===c&&d(f,161,223)?(c=0,65377+f-161):143===c&&d(f,161,254)?(c=0,e=f,null):0!==c?(h=c,c=0,l=null,d(h,161,254)&&d(f,161,254)&&(l=m(94*(h-161)+
f-161,A.jis0208)),d(f,161,254)||a.offset(-1),null===l?g(b):l):d(f,0,127)?f:142===f||143===f||d(f,161,254)?(c=f,null):g(b)}}function F(a){this.encode=function(a,b){var c=b.get();if(-1===c)return-1;b.offset(1);if(d(c,0,127))return a.emit(c);if(165===c)return a.emit(92);if(8254===c)return a.emit(126);if(d(c,65377,65439))return a.emit(142,c-65377+161);var g=p(c,A.jis0208);if(null===g)return l(c);c=f(g,94)+161;return a.emit(c,g%94+161)}}function D(a){var b=a.fatal,c=0,f=!1,e=0;this.decode=function(a){var h=
a.get();-1!==h&&a.offset(1);switch(c){default:case 0:return 27===h?(c=1,null):d(h,0,127)?h:-1===h?-1:g(b);case 1:if(36===h||40===h)return e=h,c=2,null;-1!==h&&a.offset(-1);c=0;return g(b);case 2:var l=e;e=0;if(36===l&&(64===h||66===h))return f=!1,c=4,null;if(36===l&&40===h)return c=3,null;if(40===l&&(66===h||74===h))return c=0,null;if(40===l&&73===h)return c=6,null;-1===h?a.offset(-1):a.offset(-2);c=0;return g(b);case 3:if(68===h)return f=!0,c=4,null;-1===h?a.offset(-2):a.offset(-3);c=0;return g(b);
case 4:if(10===h)return c=0,g(b,10);if(27===h)return c=1,null;if(-1===h)return-1;e=h;c=5;return null;case 5:c=4;if(-1===h)return g(b);a=null;l=94*(e-33)+h-33;d(e,33,126)&&d(h,33,126)&&(a=!1===f?m(l,A.jis0208):m(l,A.jis0212));return null===a?g(b):a;case 6:return 27===h?(c=1,null):d(h,33,95)?65377+h-33:-1===h?-1:g(b)}}}function t(a){var b=0;this.encode=function(a,c){var g=c.get();if(-1===g)return-1;c.offset(1);if((d(g,0,127)||165===g||8254===g)&&0!==b)return c.offset(-1),b=0,a.emit(27,40,66);if(d(g,
0,127))return a.emit(g);if(165===g)return a.emit(92);if(8254===g)return a.emit(126);if(d(g,65377,65439)&&2!==b)return c.offset(-1),b=2,a.emit(27,40,73);if(d(g,65377,65439))return a.emit(g-65377-33);if(1!==b)return c.offset(-1),b=1,a.emit(27,36,66);var e=p(g,A.jis0208);if(null===e)return l(g);g=f(e,94)+33;return a.emit(g,e%94+33)}}function C(a){var b=a.fatal,c=0;this.decode=function(a){var f=a.get();if(-1===f&&0===c)return-1;if(-1===f&&0!==c)return c=0,g(b);a.offset(1);if(0!==c){var e=c;c=0;if(d(f,
64,126)||d(f,128,252))return a=m(188*(e-(160>e?129:193))+f-(127>f?64:65),A.jis0208),null===a?g(b):a;a.offset(-1);return g(b)}return d(f,0,128)?f:d(f,161,223)?65377+f-161:d(f,129,159)||d(f,224,252)?(c=f,null):g(b)}}function H(a){this.encode=function(a,b){var c=b.get();if(-1===c)return-1;b.offset(1);if(d(c,0,128))return a.emit(c);if(165===c)return a.emit(92);if(8254===c)return a.emit(126);if(d(c,65377,65439))return a.emit(c-65377+161);var g=p(c,A.jis0208);if(null===g)return l(c);c=f(g,188);g%=188;return a.emit(c+
(31>c?129:193),g+(63>g?64:65))}}function I(a){var b=a.fatal,c=0;this.decode=function(a){var f=a.get();if(-1===f&&0===c)return-1;if(-1===f&&0!==c)return c=0,g(b);a.offset(1);if(0!==c){var e=c,h=null;c=0;if(d(e,129,198)){var l=178*(e-129);d(f,65,90)?h=l+f-65:d(f,97,122)?h=l+26+f-97:d(f,129,254)&&(h=l+26+26+f-129)}d(e,199,253)&&d(f,161,254)&&(h=12460+94*(e-199)+(f-161));f=null===h?null:m(h,A["euc-kr"]);null===h&&a.offset(-1);return null===f?g(b):f}return d(f,0,127)?f:d(f,129,253)?(c=f,null):g(b)}}function M(a){this.encode=
function(a,c){var b=c.get();if(-1===b)return-1;c.offset(1);if(d(b,0,127))return a.emit(b);var g=p(b,A["euc-kr"]);if(null===g)return l(b);if(12460>g)return b=f(g,178)+129,g%=178,a.emit(b,g+(26>g?65:52>g?71:77));g-=12460;b=f(g,94)+199;return a.emit(b,g%94+161)}}function Q(a){var b=a.fatal,c=0,f=0;this.decode=function(a){var e=a.get();-1!==e&&a.offset(1);switch(c){default:case 0:return 14===e?(c=4,null):15===e?null:27===e?(c=1,null):d(e,0,127)?e:-1===e?-1:g(b);case 1:if(36===e)return c=2,null;-1!==e&&
a.offset(-1);c=0;return g(b);case 2:if(41===e)return c=3,null;-1===e?a.offset(-1):a.offset(-2);c=0;return g(b);case 3:if(67===e)return c=0,null;-1===e?a.offset(-2):a.offset(-3);c=0;return g(b);case 4:if(10===e)return c=0,g(b,10);if(14===e)return null;if(15===e)return c=0,null;if(-1===e)return-1;f=e;c=5;return null;case 5:c=4;if(-1===e)return g(b);a=null;d(f,33,70)&&d(e,33,126)?a=m(178*(f-1)+52+e-1,A["euc-kr"]):d(f,71,126)&&d(e,33,126)&&(a=m(12460+94*(f-71)+(e-33),A["euc-kr"]));return null!==a?a:g(b)}}}
function R(a){var b=!1,c=0;this.encode=function(a,g){var e=g.get();if(-1===e)return-1;b||(b=!0,a.emit(27,36,41,67));g.offset(1);if(d(e,0,127)&&0!==c)return g.offset(-1),c=0,a.emit(15);if(d(e,0,127))return a.emit(e);if(1!==c)return g.offset(-1),c=1,a.emit(14);var h=p(e,A["euc-kr"]);if(null===h)return l(e);var m;if(12460>h)return m=f(h,178)+1,h=h%178-26-26+1,!d(m,33,70)||!d(h,33,126)?l(e):a.emit(m,h);h-=12460;m=f(h,94)+71;h=h%94+33;return!d(m,71,126)||!d(h,33,126)?l(e):a.emit(m,h)}}function N(a,c){var b=
c.fatal,f=null,e=null;this.decode=function(c){var h=c.get();if(-1===h&&null===f&&null===e)return-1;if(-1===h&&(null!==f||null!==e))return g(b);c.offset(1);if(null===f)return f=h,null;h=a?(f<<8)+h:(h<<8)+f;f=null;if(null!==e){var l=e;e=null;if(d(h,56320,57343))return 65536+1024*(l-55296)+(h-56320);c.offset(-2);return g(b)}return d(h,55296,56319)?(e=h,null):d(h,56320,57343)?g(b):h}}function O(a,c){this.encode=function(c,b){function g(b){var d=b>>8;b&=255;return a?c.emit(d,b):c.emit(b,d)}var e=b.get();
if(-1===e)return-1;b.offset(1);d(e,55296,57343)&&l(e);if(65535>=e)return g(e);var h=f(e-65536,1024)+55296,e=(e-65536)%1024+56320;g(h);return g(e)}}function K(a,b){if(!this||this===k)return new K(a,b);a=a?String(a):"utf-8";b=Object(b);this._encoding=r(a);if(null===this._encoding||"utf-8"!==this._encoding.name&&"utf-16"!==this._encoding.name&&"utf-16be"!==this._encoding.name)throw new TypeError("Unknown encoding: "+a);this._streaming=!1;this._encoder=null;this._options={fatal:Boolean(b.fatal)};Object.defineProperty?
Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name;return this}function L(a,b){if(!this||this===k)return new L(a,b);a=a?String(a):"utf-8";b=Object(b);this._encoding=r(a);if(null===this._encoding)throw new TypeError("Unknown encoding: "+a);this._streaming=!1;this._decoder=null;this._options={fatal:Boolean(b.fatal)};Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=
this._encoding.name;return this}if(!(void 0!==k.TextEncoder&&void 0!==k.TextDecoder)){h.prototype=Error.prototype;var z={},J={};[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:"csisolatin2 iso-8859-2 iso-ir-101 iso8859-2 iso_8859-2 l2 latin2".split(" "),name:"iso-8859-2"},{labels:"csisolatin3 iso-8859-3 iso_8859-3 iso-ir-109 l3 latin3".split(" "),
name:"iso-8859-3"},{labels:"csisolatin4 iso-8859-4 iso_8859-4 iso-ir-110 l4 latin4".split(" "),name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:"arabic csisolatinarabic ecma-114 iso-8859-6 iso_8859-6 iso-ir-127".split(" "),name:"iso-8859-6"},{labels:"csisolatingreek ecma-118 elot_928 greek greek8 iso-8859-7 iso_8859-7 iso-ir-126".split(" "),name:"iso-8859-7"},{labels:"csisolatinhebrew hebrew iso-8859-8 iso-8859-8-i iso-ir-138 iso_8859-8 visual".split(" "),
name:"iso-8859-8"},{labels:"csisolatin6 iso-8859-10 iso-ir-157 iso8859-10 l6 latin6".split(" "),name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620",
"windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:"ascii ansi_x3.4-1968 csisolatin1 iso-8859-1 iso8859-1 iso_8859-1 l1 latin1 us-ascii windows-1252".split(" "),name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:"csisolatin5 iso-8859-9 iso-ir-148 l5 latin5 windows-1254".split(" "),name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256",
"windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:"chinese csgb2312 csiso58gb231280 gb2312 gbk gb_2312 gb_2312-80 iso-ir-58 x-gbk".split(" "),name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},
{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:"csshiftjis ms_kanji shift-jis shift_jis sjis windows-31j x-sjis".split(" "),name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:"cseuckr csksc56011987 euc-kr iso-ir-149 korean ks_c_5601-1987 ks_c_5601-1989 ksc5601 ksc_5601 windows-949".split(" "),
name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach(function(a){a.encodings.forEach(function(a){z[a.name]=a;a.labels.forEach(function(b){J[b]=a})})});var A=k["encoding-indexes"]||{};z["utf-8"].getEncoder=function(a){return new s(a)};z["utf-8"].getDecoder=function(a){return new q(a)};(function(){"ibm864 ibm866 iso-8859-2 iso-8859-3 iso-8859-4 iso-8859-5 iso-8859-6 iso-8859-7 iso-8859-8 iso-8859-10 iso-8859-13 iso-8859-14 iso-8859-15 iso-8859-16 koi8-r koi8-u macintosh windows-874 windows-1250 windows-1251 windows-1252 windows-1253 windows-1254 windows-1255 windows-1256 windows-1257 windows-1258 x-mac-cyrillic".split(" ").forEach(function(a){var b=
z[a],c=A[a];b.getDecoder=function(a){return new n(c,a)};b.getEncoder=function(a){return new y(c,a)}})})();z.gbk.getEncoder=function(a){return new u(!1,a)};z.gbk.getDecoder=function(a){return new w(!1,a)};z.gb18030.getEncoder=function(a){return new u(!0,a)};z.gb18030.getDecoder=function(a){return new w(!0,a)};z["hz-gb-2312"].getEncoder=function(a){return new x(a)};z["hz-gb-2312"].getDecoder=function(a){return new v(a)};z.big5.getEncoder=function(a){return new E(a)};z.big5.getDecoder=function(a){return new B(a)};
z["euc-jp"].getEncoder=function(a){return new F(a)};z["euc-jp"].getDecoder=function(a){return new G(a)};z["iso-2022-jp"].getEncoder=function(a){return new t(a)};z["iso-2022-jp"].getDecoder=function(a){return new D(a)};z.shift_jis.getEncoder=function(a){return new H(a)};z.shift_jis.getDecoder=function(a){return new C(a)};z["euc-kr"].getEncoder=function(a){return new M(a)};z["euc-kr"].getDecoder=function(a){return new I(a)};z["iso-2022-kr"].getEncoder=function(a){return new R(a)};z["iso-2022-kr"].getDecoder=
function(a){return new Q(a)};z["utf-16"].getEncoder=function(a){return new O(!1,a)};z["utf-16"].getDecoder=function(a){return new N(!1,a)};z["utf-16be"].getEncoder=function(a){return new O(!0,a)};z["utf-16be"].getDecoder=function(a){return new N(!0,a)};K.prototype={encode:function(c,d){c=c?String(c):"";d=Object(d);this._streaming||(this._encoder=this._encoding.getEncoder(this._options));this._streaming=Boolean(d.stream);for(var e=[],g=new a(e),f=new b(c);-1!==f.get();)this._encoder.encode(g,f);if(!this._streaming){var h;
do h=this._encoder.encode(g,f);while(-1!==h);this._encoder=null}return new Uint8Array(e)}};L.prototype={decode:function(a,b){if(a&&!("buffer"in a&&"byteOffset"in a&&"byteLength"in a))throw new TypeError("Expected ArrayBufferView");a||(a=new Uint8Array(0));b=Object(b);this._streaming||(this._decoder=this._encoding.getDecoder(this._options));this._streaming=Boolean(b.stream);var d=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=new e(d);if(!this._BOMseen){this._BOMseen=!0;var g=this._encoding.name;
d.match([255,254])&&"utf-16"===g?d.offset(2):d.match([254,255])&&"utf-16be"==g?d.offset(2):d.match([239,187,191])&&"utf-8"==g&&d.offset(3)}for(var g=new c,f;-1!==d.get();)f=this._decoder.decode(d),null!==f&&-1!==f&&g.emit(f);if(!this._streaming){do f=this._decoder.decode(d),null!==f&&-1!==f&&g.emit(f);while(-1!==f&&-1!=d.get());this._decoder=null}return g.string()}};k.TextEncoder=k.TextEncoder||K;k.TextDecoder=k.TextDecoder||L}})(this);
(function(k){OT.Rumor={MessageType:{SUBSCRIBE:0,UNSUBSCRIBE:1,MESSAGE:2,CONNECT:3,DISCONNECT:4,PING:7,PONG:8,STATUS:9}}})(this);
(function(k){var d={1002:"The endpoint is terminating the connection due to a protocol error. (CLOSE_PROTOCOL_ERROR)",1003:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data). (CLOSE_UNSUPPORTED)",1004:"The endpoint is terminating the connection because a data frame was received that is too large. (CLOSE_TOO_LARGE)",1005:"Indicates that no status code was provided even though one was expected. (CLOSE_NO_STATUS)",
1006:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected. (CLOSE_ABNORMAL)",1007:"Indicates that an endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 [RFC3629] data within a text message)",1008:"Indicates that an endpoint is terminating the connection because it has received a message that violates its policy.  This is a generic status code that can be returned when there is no other more suitable status code (e.g., 1003 or 1009) or if there is a need to hide specific details about the policy",
1009:"Indicates that an endpoint is terminating the connection because it has received a message that is too big for it to process",1011:"Indicates that a server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request",4001:"Connectivity loss was detected as it was too long since the socket received the last PONG message"};OT.Rumor.SocketError=function(d,e){this.code=d;this.message=e};OT.Rumor.Socket=function(f,e,a){var b,c,h,g,l,
k,m,p,q,s,n,y=OT.$.statable(this,["disconnected","error","connected","connecting","disconnecting"],"disconnected",function(a){switch(a){case "disconnected":case "error":if(b=null,l){var c;if(!s?0:44900<=OT.$.now()-s)c=Error(d[4001]),c.code=4001;l(c)}}}),w=function(a,b){if(null===b||!OT.$.isFunction(b))throw Error("The Rumor.Socket "+a+" callback must be a valid function or null");},u=function(a){OT.error("Rumor.Socket: "+a);a=new OT.Rumor.SocketError(null,a||"Unknown Socket Error");q&&clearTimeout(q);
y("error");"connecting"===this.previousState&&m&&(m(a,null),m=null);g&&g(a)}.bind(this),v=function C(a){b&&(void 0===a&&(a=0),p&&clearTimeout(p),0<b.bufferedAmount&&10>=a+1?p=setTimeout(C,100,a+1):(y("disconnecting"),p&&(clearTimeout(p),p=null),console.info("CALLED CLOSE ON WEBSOCKET"),b.close()))},x=function H(){this.is("connected")&&((!s?0:44900<=OT.$.now()-s)?F({code:4001}):(b.send(OT.Rumor.Message.Ping().serialize()),n=setTimeout(H.bind(this),9E3)))}.bind(this),B=function(){q&&clearTimeout(q);
b.send(OT.Rumor.Message.Connect(c,e).serialize());y("connected");m&&(m(null,c),m=null);h&&h(c);setTimeout(function(){s=OT.$.now();x()},9E3)},E=function(){u("Timed out while waiting for the Rumor socket to connect.")},G=function(a){},F=function(a){q&&clearTimeout(q);n&&clearTimeout(n);if(1E3!==a.code&&1001!==a.code){var b=a.reason||a.message;!b&&d.hasOwnProperty(a.code)&&(b=d[a.code]);u("Rumor Socket Disconnected: "+b)}this.isNot("error")&&y("disconnected")}.bind(this),D=function(a){s=OT.$.now();k&&
(a=OT.Rumor.Message.deserialize(a.data),a.type!==OT.Rumor.MessageType.PONG&&k(a.toAddress,a.data))};this.publish=function(a,c){b.send(OT.Rumor.Message.Publish(a,c).serialize())};this.subscribe=function(a){b.send(OT.Rumor.Message.Subscribe(a).serialize())};this.unsubscribe=function(a){b.send(OT.Rumor.Message.Unsubscribe(a).serialize())};this.connect=function(d,g){if(this.is("connecting","connected"))g(new OT.Rumor.SocketError(null,"Rumor.Socket cannot connect when it is already connecting or connected."));
else{c=d;m=g;try{y("connecting"),b=new (a||WebSocket)(f),b.binaryType="arraybuffer",b.onopen=B,b.onclose=F,b.onerror=G,b.onmessage=D,q=setTimeout(E,OT.Rumor.Socket.CONNECT_TIMEOUT)}catch(e){OT.error(e),u("Could not connect to the Rumor socket, possibly because of a blocked port.")}}};this.disconnect=function(){q&&clearTimeout(q);n&&clearTimeout(n);b?3===b.readyState?this.isNot("error")&&y("disconnected"):(this.is("connected")&&b.send(OT.Rumor.Message.Disconnect().serialize()),v()):this.isNot("error")&&
y("disconnected")};Object.defineProperties(this,{id:{get:function(){return c}},onOpen:{set:function(a){w("onOpen",a);h=a},get:function(){return h}},onError:{set:function(a){w("onError",a);g=a},get:function(){return g}},onClose:{set:function(a){w("onClose",a);l=a},get:function(){return l}},onMessage:{set:function(a){w("onMessage",a);k=a},get:function(){return k}}})};OT.Rumor.Socket.CONNECT_TIMEOUT=15E3})(this);
(function(k){OT.Rumor.Message=function(d,f,e,a){this.type=d;this.toAddress=f;this.headers=e;this.data=a};OT.Rumor.Message.prototype.serialize=function(){var d=8,f=7,e=Array(this.toAddress.length),a=Array(this.headers.length),b=Array(this.headers.length),c;f++;for(var h=0;h<this.toAddress.length;h++)e[h]=(new TextEncoder("utf-8")).encode(this.toAddress[h]),f+=2,f+=e[h].length;f++;for(h=0;h<this.headers.length;h++)a[h]=(new TextEncoder("utf-8")).encode(this.headers[h].key),b[h]=(new TextEncoder("utf-8")).encode(this.headers[h].val),
f+=4,f+=a[h].length,f+=b[h].length;c=(new TextEncoder("utf-8")).encode(this.data);var f=f+c.length,g=new ArrayBuffer(f),l=new Uint8Array(g,0,f),f=f-4;l[0]=(f&4278190080)>>>24;l[1]=(f&16711680)>>>16;l[2]=(f&65280)>>>8;l[3]=(f&255)>>>0;l[4]=0;l[5]=0;l[6]=this.type;l[7]=this.toAddress.length;for(h=0;h<e.length;h++){strArray=e[h];l[d++]=strArray.length>>8&255;l[d++]=strArray.length>>0&255;for(f=0;f<strArray.length;f++)l[d++]=strArray[f]}l[d++]=a.length;for(h=0;h<a.length;h++){strArray=a[h];l[d++]=strArray.length>>
8&255;l[d++]=strArray.length>>0&255;for(f=0;f<strArray.length;f++)l[d++]=strArray[f];strArray=b[h];l[d++]=strArray.length>>8&255;l[d++]=strArray.length>>0&255;for(f=0;f<strArray.length;f++)l[d++]=strArray[f]}for(h=0;h<c.length;h++)l[d++]=c[h];return g};OT.Rumor.Message.deserialize=function(d){var f,e=8,a=new Uint8Array(d);f=a[6];for(var b=[],c=0;c<a[7];c++){length=a[e++]<<8;length+=a[e++];var h=new Uint8Array(d,e,length);b[c]=(new TextDecoder("utf-8")).decode(h);e+=length}for(var g=a[e++],l=[],c=
0;c<g;c++){length=a[e++]<<8;length+=a[e++];var h=new Uint8Array(d,e,length),k=(new TextDecoder("utf-8")).decode(h),e=e+length;length=a[e++]<<8;length+=a[e++];h=new Uint8Array(d,e,length);h=(new TextDecoder("utf-8")).decode(h);l[c]={key:k,val:h};e+=length}d=new Uint8Array(d,e);d=(new TextDecoder("utf-8")).decode(d);return new OT.Rumor.Message(f,b,l,d)};OT.Rumor.Message.Connect=function(d,f){return new OT.Rumor.Message(OT.Rumor.MessageType.CONNECT,[],[{key:"uniqueId",val:d},{key:"notifyDisconnectAddress",
val:f}],"")};OT.Rumor.Message.Disconnect=function(){return new OT.Rumor.Message(OT.Rumor.MessageType.DISCONNECT,[],[],"")};OT.Rumor.Message.Subscribe=function(d){return new OT.Rumor.Message(OT.Rumor.MessageType.SUBSCRIBE,d,[],"")};OT.Rumor.Message.Unsubscribe=function(d){return new OT.Rumor.Message(OT.Rumor.MessageType.UNSUBSCRIBE,d,[],"")};OT.Rumor.Message.Publish=function(d,f,e){return new OT.Rumor.Message(OT.Rumor.MessageType.MESSAGE,d,[],f)};OT.Rumor.Message.Ping=function(){return new OT.Rumor.Message(OT.Rumor.MessageType.PING,
[],[],"")}})(this);
(function(k){OT.Raptor={Actions:{CONNECT:100,CREATE:101,UPDATE:102,DELETE:103,STATE:104,FORCE_DISCONNECT:105,FORCE_UNPUBLISH:106,SIGNAL:107,CREATE_ARCHIVE:108,CLOSE_ARCHIVE:109,START_RECORDING_SESSION:110,STOP_RECORDING_SESSION:111,START_RECORDING_STREAM:112,STOP_RECORDING_STREAM:113,LOAD_ARCHIVE:114,START_PLAYBACK:115,STOP_PLAYBACK:116,APPSTATE_PUT:117,APPSTATE_DELETE:118,OFFER:119,ANSWER:120,PRANSWER:121,CANDIDATE:122,SUBSCRIBE:123,UNSUBSCRIBE:124,QUERY:125,SDP_ANSWER:126,PONG:127,REGISTER:128,
QUALITY_CHANGED:129},Types:{RPC_REQUEST:100,RPC_RESPONSE:101,STREAM:102,ARCHIVE:103,CONNECTION:104,APPSTATE:105,CONNECTIONCOUNT:106,MODERATION:107,SIGNAL:108,SUBSCRIBER:110,JSEP:109}}})(this);
(function(k){var d={},f={};k=OT.Raptor.Types;for(var e in k)d[k[e]]=e;k=OT.Raptor.Actions;for(e in k)f[k[e]]=e;OT.Raptor.serializeMessage=function(a){return JSON.stringify(a)};OT.Raptor.deserializeMessage=function(a){a=JSON.parse(a);a.type&&(a.type=parseInt(a.type,10),a.typeName=d[a.type]||null);a.action&&(a.action=parseInt(a.action,10),a.actionName=f[a.action]||null);a.signature=a.typeName+":"+a.actionName;return a};OT.Raptor.Message={};OT.Raptor.Message.connect=function(a,b,c,d,g,e){a={credentials:{connectionId:b,
soAccessState:2,supportsWebRTC:!0,p2pEnabled:e,GUID:a,widgetId:a,partnerId:d},sessionId:c,params:{tokenPermissions:{apiKey:d},token:g},uniqueId:b};return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.CONNECT,payload:a,replyTo:b})};OT.Raptor.Message.getSessionState=function(a,b,c){return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.STATE,payload:{sessionId:b,connectionsRequired:c||!0},replyTo:a})};
OT.Raptor.Message.forceDisconnect=function(a,b,c){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.FORCE_DISCONNECT,payload:{connectionId:b,sessionId:c},replyTo:a})};OT.Raptor.Message.streamCreate=function(a,b,c,d,g,e,f,m,k,q){b={key:b,value:{p2pEnabled:q||!1,publisherId:c,connection:{connectionId:a},type:"WebRTC",name:d||"",creationTime:Date.now(),orientation:{width:e,height:f,videoOrientation:g||"OTVideoOrientationRotatedNormal"},hasAudio:void 0!==
m?m:!0,hasVideo:void 0!==k?k:!0}};return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.CREATE,payload:b,replyTo:""})};OT.Raptor.Message.streamDestroy=function(a,b,c){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.DELETE,payload:{key:b+"/STREAMS/"+c},replyTo:a})};OT.Raptor.Message.streamModify=function(a,b,c,d,g){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.UPDATE,payload:{key:[b,
"STREAMS",c,d].join("/"),value:g},replyTo:a})};OT.Raptor.Message.forceUnpublish=function(a,b,c){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.FORCE_UNPUBLISH,payload:{sessionId:b,connectionId:a,streamId:c,webRTCStream:!0},replyTo:a})};OT.Raptor.Message.jsepOffer=function(a,b,c,d){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.OFFER,payload:{fromAddress:a,toAddresses:b,sdp:d,streamId:c},replyTo:a})};OT.Raptor.Message.jsepAnswer=
function(a,b,c,d){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.ANSWER,payload:{fromAddress:a,toAddresses:b,sdp:d,streamId:c},replyTo:a})};OT.Raptor.Message.jsepSubscribe=function(a,b,c,d,g){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.SUBSCRIBE,payload:{keyManagemenMethod:OT.$.supportedCryptoScheme(),bundleSupport:OT.$.supportsBundle(),rtcpMuxSupport:OT.$.supportsRtcpMux(),fromAddress:a,toAddresses:b,streamId:c,
hasVideo:d,hasAudio:g},replyTo:a})};OT.Raptor.Message.jsepUnsubscribe=function(a,b,c){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.UNSUBSCRIBE,payload:{fromAddress:a,toAddresses:b,streamId:c},replyTo:a})};OT.Raptor.Message.jsepCandidate=function(a,b,c,d){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.CANDIDATE,payload:{fromAddress:a,toAddresses:b,candidate:d,streamId:c},replyTo:a})};OT.Raptor.Message.subscriberModify=
function(a,b,c,d,g,e){return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.SUBSCRIBER,action:OT.Raptor.Actions.UPDATE,payload:{key:[b,"SUBSCRIBER",c,a,g].join("/"),value:e},replyTo:a})};OT.Raptor.Message.signal=function(a,b,c,d,g){var e={id:OT.$.uuid(),fromAddress:a};d&&!Array.isArray(d)?e.toAddresses=[d]:e.toAddresses=!d||0===d.length?[b]:d;void 0!==c&&(e.type=c);void 0!==g&&(e.data=g);return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.SIGNAL,action:OT.Raptor.Actions.SIGNAL,
payload:e,replyTo:a})}})(this);
(function(k){OT.Signal=function(d,f,e){var a=function(a){if(a){if(!Array.isArray(a))return{code:400,reason:"The To field was invalid"}}else return{code:400,reason:"The signal type was null or an empty String. Either set it to a non-empty String value or omit it"};for(var b=0;b<a.length;b++)if(!(a[b]instanceof OT.Connection||a[b]instanceof OT.Session))return{code:400,reason:"The To field was invalid"};return null},b=function(a){var b=null;null===a||void 0===a?b={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"}:
128<a.length?b={code:413,reason:"The signal type was too long, the maximum length of it is 128 characters"}:/^[a-zA-Z0-9\-\._~]+$/.exec(a)||(b={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."});return b},c=function(a){var b=null;if(null===a||void 0===a)b={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};else try{8192<JSON.stringify(a).length&&(b={code:413,reason:"The data field was too long, the maximum size of it is 8192 characters"})}catch(c){b=
{code:400,reason:"The data field was not valid JSON"}}return b};this.toRaptorMessage=function(){var a;this.to&&(a=this.to.map(function(a){return"string"===typeof a?a:a.id}));return OT.Raptor.Message.signal(f,d,this.type,a,this.data)};this.toHash=function(){var a=OT.$.clone(e);void 0===a.to&&(a.to=null);void 0===a.data&&(a.data=null);return a};this.error=null;e&&(e.hasOwnProperty("data")&&(this.data=OT.$.clone(e.data),this.error=c(this.data)),e.hasOwnProperty("to")&&(Array.isArray(e.to)?this.to=OT.$.clone(e.to):
this.to=[e.to],this.error||(this.error=a(this.to))),e.hasOwnProperty("type")&&(this.error||(this.error=b(e.type)),this.type=e.type));this.valid=null===this.error}})(this);
(function(k){function d(d,e,a){this.code=d;this.reason=e;this.signal=a}OT.Raptor.Socket=function(f,e,a){var b=OT.properties.messagingProtocol+"://"+e+":"+OT.properties.messagingPort+"/rumorwebsocketsv2",c="symphony."+e,h,g,l,k,m=new OT.Capabilities([]),p=new OT.Analytics,q=OT.$.statable(this,["disconnected","connecting","connected","error","disconnecting"],"disconnected"),s=function(a,b,c,d){a={action:"Connect",variation:a,payload_type:b,payload:c,session_id:h,partner_id:OT.APIKEY,widget_id:f,widget_type:"Controller"};
d&&(a=OT.$.extend(d,a));p.logEvent(a)},n=function(a,c,d){a?(s("Failure","reason|webSocketServerUrl",d+a.code+":"+a.message+"|"+b),q("error")):(s("Success","webSocketServerUrl",b,{connectionId:g.id}),q("connected"),m=new OT.Capabilities(c.permissions));k.apply(null,arguments)},y=function(a){var b=OT.sessions.get(h).connection,c=this.is("disconnecting")?"clientDisconnected":"networkDisconnected";a&&4001==a.code&&(c="networkTimedout");q("disconnected");b&&(b.destroyedReason?console.debug("OT.Raptor.Socket: Socket was closed but the connection had already been destroyed. Reason: "+
b.destroyedReason):b.destroy(c))}.bind(this),w=function(){};this.permittedTo=function(a){return 1===m[a]};this.connect=function(a,d,m){this.is("disconnected","error")?(q("connecting"),h=d.sessionId,k=m,m=OT.$.uuid(),OT.sessions.get(h),s("Attempt","webSocketServerUrl|userAgent|sdkVersion|chromeFrame",[b,navigator.userAgent,OT.properties.version,window.externalHost?"yes":"no"].map(function(a){return a.replace("|","\\|")}).join("|")),g=new OT.Rumor.Socket(b,c),g.onClose=y,g.onMessage=l.dispatch.bind(l),
g.connect(m,function(b){b?n(b,null,"WebSocketConnection:"):(g.onError=w,OT.debug("Raptor Socket connected to "+h+" on "+e),g.subscribe([h]),b=OT.Raptor.Message.connect(f,g.id,h,OT.APIKEY,a,d.p2pEnabled),this.publish(b))}.bind(this))):OT.warn("Cannot connect the Raptor Socket as it is currently connected. You should disconnect first.")};this.disconnect=function(){this.is("disconnected")||(q("disconnecting"),g.disconnect())};this.publish=function(a){g.isNot("connected")?OT.error("OT.Raptor.Socket: cannot publish until the socket is connected."+
a):(OT.debug("OT.Raptor.Socket Publish: "+a),g.publish([c],a))};this.createStream=function(a,b,c,d,e,f,l){var m=OT.sessions.get(h);a=OT.Raptor.Message.streamCreate(g.id,h,a,b,c,d,e,f,l,m.sessionInfo.p2pEnabled);this.publish(a)};this.updateStream=function(a,b,c){this.publish(OT.Raptor.Message.streamModify(g.id,h,a,b,c))};this.destroyStream=function(a){this.publish(OT.Raptor.Message.streamDestroy(g.id,h,a))};this.modifySubscriber=function(a,b,c){this.publish(OT.Raptor.Message.subscriberModify(g.id,
h,a.streamId,a.widgetId,b,c))};this.forceDisconnect=function(a){this.publish(OT.Raptor.Message.forceDisconnect(g.id,a,h))};this.forceUnpublish=function(a){this.publish(OT.Raptor.Message.forceUnpublish(g.id,h,a))};this.jsepSubscribe=function(a,b,c,d){this.publish(OT.Raptor.Message.jsepSubscribe(g.id,a,b,c,d))};this.jsepUnsubscribe=function(a,b){this.publish(OT.Raptor.Message.jsepUnsubscribe(g.id,a,b))};this.jsepCandidate=function(a,b,c){this.publish(OT.Raptor.Message.jsepCandidate(g.id,a,b,c))};this.jsepOffer=
function(a,b,c){this.publish(OT.Raptor.Message.jsepOffer(g.id,a,b,c))};this.jsepAnswer=function(a,b,c){this.publish(OT.Raptor.Message.jsepAnswer(g.id,a,b,c))};this.signal=function(a,b){var c=new OT.Signal(h,g.id,a||{});c.valid?(this.publish(c.toRaptorMessage()),b&&OT.$.isFunction(b)&&b(null,c.toHash())):b&&OT.$.isFunction(b)&&b(new d(c.error.code,c.error.reason,c.toHash()))};OT.$.defineGetters(this,{id:function(){return g.id},capabilities:function(){return m},sessionId:function(){return h}});l=new (a||
OT.Raptor.Dispatcher)(this,function(a,b){n.call(this,a,b,"ConnectToSession:")})}})(this);
(function(k){function d(a,b){var c=new OT.Stream(a.streamId,b.connections.get(a.connection.connectionId),a.name,a.streamData,a.type,a.creationTime,a.hasAudio,a.hasVideo,a.orientation?a.orientation.videoOrientation:null,a.peerId,a.quality,a.orientation?a.orientation.width:null,a.orientation?a.orientation.height:null);a.publisherId&&(c.publisherId=a.publisherId);return c}function f(a,b){if(!b.streams.has(a.streamId)){var c=d(a,b);b.streams.add(c);return c}}var e={409:"This P2P session already has 2 participants.",
410:"The session already has four participants.",1004:"The token passed is invalid."};OT.publishers=new OT.Collection("guid");OT.subscribers=new OT.Collection("widgetId");OT.sessions=new OT.Collection;OT.Raptor.Dispatcher=function(a,b){this.socket=a;this.connectionCompletion=b};OT.Raptor.Dispatcher.prototype.dispatch=function(a,b){var c=OT.Raptor.deserializeMessage(b);if(c.typeName)if(c.actionName)switch(OT.debug("OT.Raptor.dispatch "+c.signature+": "+b),c.type){case OT.Raptor.Types.RPC_RESPONSE:this.dispatchRPCResponse(c);
break;case OT.Raptor.Types.CONNECTION:this.dispatchConnection(c);break;case OT.Raptor.Types.CONNECTIONCOUNT:this.dispatchConnectionCount(c);break;case OT.Raptor.Types.STREAM:this.dispatchStream(c);break;case OT.Raptor.Types.SUBSCRIBER:this.dispatchSubscriber(c);break;case OT.Raptor.Types.MODERATION:this.dispatchModeration(c);break;case OT.Raptor.Types.JSEP:this.dispatchJsep(c);break;case OT.Raptor.Types.SIGNAL:this.dispatchSignal(c);break;default:OT.warn("OT.Raptor.dispatch: Type "+c.typeName+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Invalid action ("+
c.action+") for "+c.typeName),OT.error(c);else OT.error("OT.Raptor.dispatch: Invalid message type ("+c.type+")")};OT.Raptor.Dispatcher.prototype.dispatchRPCResponse=function(a){switch(a.action){case OT.Raptor.Actions.CONNECT:if(!1==a.payload.connectSuccess){var b=new OT.Error(OT.ExceptionCodes.CONNECT_REJECTED,e[a.payload.reason]||"Failed to connect");this.connectionCompletion.call(null,b)}else this.socket.publish(OT.Raptor.Message.getSessionState(this.socket.id,a.payload.sessionId,!0));break;case OT.Raptor.Actions.STATE:b=
a.payload.value;a=OT.sessions.get(a.payload.key);var c;b.streams=[];b.connections=[];b.archives=[];if(b.hasOwnProperty("CONNECTIONS")){for(var d in b.CONNECTIONS)c=OT.Connection.fromHash(b.CONNECTIONS[d]),b.connections.push(c),a.connections.add(c);delete b.CONNECTIONS}if(b.hasOwnProperty("STREAMS")){for(d in b.STREAMS)b.streams.push(f(b.STREAMS[d],a));delete b.STREAMS}this.connectionCompletion.call(null,null,b);break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}};
OT.Raptor.Dispatcher.prototype.dispatchConnection=function(a){var b=OT.sessions.get(a.payload.value.sessionId),c;if(b)switch(a.action){case OT.Raptor.Actions.CREATE:c=OT.Connection.fromHash(a.payload.value);b.connection&&c.id!==b.connection.id&&b.connections.add(c);break;case OT.Raptor.Actions.DELETE:c=b.connections.get(a.payload.value.connectionId);c.destroy(a.payload.reason);break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine session for "+
a.payload.value.sessionId+" on "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchConnectionCount=function(a){};OT.Raptor.Dispatcher.prototype.dispatchStream=function(a){var b=a.payload.key.split("/"),c=b[0],e,g;c&&(e=OT.sessions.get(c));if(e)switch(a.action){case OT.Raptor.Actions.REGISTER:g=d(a.payload.value,e);g.publisherId&&((b=OT.publishers.get(g.publisherId))?b._.streamRegisteredHandler(g):OT.warn("OT.Raptor.dispatch: Could find a publisher "+g.publisherId+" for "+a.signature));
break;case OT.Raptor.Actions.CREATE:f(a.payload.value,e);break;case OT.Raptor.Actions.UPDATE:b[1]&&(g=e.streams.get(b[1]));if(!g){OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");break}g.update(b[2],a.payload.value);break;case OT.Raptor.Actions.DELETE:b[2]&&(g=e.streams.get(b[2]));if(!g){OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");break}g.destroy(a.payload.reason);
break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine sessionId, or the session does not exist, for "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchModeration=function(a){};OT.Raptor.Dispatcher.prototype.dispatchJsep=function(a){var b,c=a.payload.streamId,d;switch(a.action){case OT.Raptor.Actions.OFFER:d=[];(c=OT.subscribers.find({streamId:c}))&&d.push(c);break;case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:case OT.Raptor.Actions.SUBSCRIBE:case OT.Raptor.Actions.UNSUBSCRIBE:d=
OT.publishers.where({streamId:c});break;case OT.Raptor.Actions.CANDIDATE:d=OT.publishers.where({streamId:c}).concat(OT.subscribers.where({streamId:c}));break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented");return}d.length&&(b=d[0].session.connections.get(a.payload.fromAddress),!b&&a.payload.fromAddress.match(/^symphony\./)?(b=new OT.Connection(a.payload.fromAddress,Date.now(),null,{supportsWebRTC:!0}),d[0].session.connections.add(b)):b||OT.warn("Messsage comes from a connection ("+
a.payload.fromAddress+") that we do not know about."));d.forEach(function(c){c.processMessage(a.action,b,a.payload)})};OT.Raptor.Dispatcher.prototype.dispatchSubscriber=function(a){var b=a.payload.key.split("/"),c=OT.sessions.get(b[0]),d;if(c)if(d=b[2]?c.streams.get(b[2]):null)if(b=OT.subscribers.find(function(a){return a.streamId===d.id&&a.session.id===c.id}))switch(a.action){case OT.Raptor.Actions.QUALITY_CHANGED:b.updateQuality(parseInt(a.payload.value,10));break;default:OT.warn("OT.Raptor.dispatch: "+
a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine subscriberId, or the subscriber does not exist, for "+a.signature+" message!");else OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");else OT.error("OT.Raptor.dispatch: Unable to determine sessionId, or the session does not exist, for "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchSignal=function(a){if(a.action!==
OT.Raptor.Actions.SIGNAL)OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented");else{var b=OT.sessions.get(this.socket.sessionId);b?b._.dispatchSignal(b.connections.get(a.payload.fromAddress),a.payload.type,a.payload.data):OT.error("OT.Raptor.dispatch: "+a.signature+" ERROR - sessionId must be provided and be valid")}}})(this);
(function(k){var d=new function(){var d=!1,e=!1,a=function(){e&&d&&OT.dispatchEvent(new OT.EnvLoadedEvent(OT.Event.names.ENV_LOADED))},b=function(){e=!0;OT.$.on(k,"unload",function(){OT.publishers.destroy();OT.subscribers.destroy();OT.sessions.destroy()});OT.Config.load(OT.properties.configURL);a()},c=function(){d=!0;OT.Config.off("dynamicConfigChanged",c);OT.Config.off("dynamicConfigLoadFailed",h);a()},h=function(){c()};OT.Config.on("dynamicConfigChanged",c);OT.Config.on("dynamicConfigLoadFailed",
h);"complete"==document.readyState||"interactive"==document.readyState&&document.body?b():document.addEventListener?document.addEventListener("DOMContentLoaded",b,!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&b()});this.onLoad=function(a){if(e&&d)a();else OT.on(OT.Event.names.ENV_LOADED,a)}};OT.onLoad=function(f,e){if(e)d.onLoad(f.bind(e));else d.onLoad(f)}})(window);
(function(k){function d(a,b,c,d){var g=f[c];d=d?OT.$.clone(d):{};OT.error("TB.exception :: title: "+g+" ("+c+") msg: "+b);d.partnerId||(d.partnerId=OT.APIKEY);try{e||(e=new OT.Analytics),e.logError(c,"tb.exception",g,{details:b},d),OT.dispatchEvent(new OT.ExceptionEvent(OT.Event.names.EXCEPTION,b,g,c,a,a))}catch(l){OT.error("TB.exception :: Failed to dispatch exception - "+l.toString())}}OT.Error=function(a,b){this.code=a;this.message=b};var f={1E3:"Failed To Load",1004:"Authentication error",1005:"Invalid Session ID",
1006:"Connect Failed",1007:"Connect Rejected",1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Connection Failed",1014:"API Response Failure",1500:"Unable to Publish",1510:"Unable to Signal",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1540:"Unable to record archive",1550:"Unable to play back archive",1560:"Unable to create archive",1570:"Unable to load archive",2E3:"Internal Error",2001:"Embed Failed",
3E3:"Archive load exception",3001:"Archive create exception",3002:"Playback stop exception",3003:"Playback start exception",3004:"Record start exception",3005:"Record stop exception",3006:"Archive load exception",3007:"Session recording in progress",3008:"Archive recording internal failure",4E3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"},e;OT.handleJsException=function(a,b,c){c=c||{};var e,f=c.session;f?(e={sessionId:f.sessionId},f.connected&&(e.connectionId=f.connection.connectionId),
c.target||(c.target=f)):c.sessionId&&(e={sessionId:c.sessionId},c.target||(c.target=null));d(c.target,a,b,e)};OT.exceptionHandler=function(a,b,c,e,f){var l;a&&((l=OT.components[a])||OT.warn("Could not find the component with component ID "+a));d(l,b,e,f)}})(window);(function(k){OT.ConnectionCapabilities=function(d){d.supportsWebRTC=OT.$.castToBoolean(d.supportsWebRTC);this.supportsWebRTC=d.supportsWebRTC}})(window);
(function(k){OT.Connection=function(d,f,e,a){var b;this.id=this.connectionId=d;this.creationTime=f?Number(f):null;this.data=e;this.capabilities=new OT.ConnectionCapabilities(a);this.quality=null;OT.$.eventing(this);this.destroy=function(a,d){b=a||"clientDisconnected";!0!==d&&this.dispatchEvent(new OT.DestroyedEvent("destroyed",this,b))}.bind(this);Object.defineProperties(this,{destroyed:{get:function(){return void 0!==b},enumerable:!0},destroyedReason:{get:function(){return b},enumerable:!0}})};OT.Connection.fromHash=
function(d){return new OT.Connection(d.connectionId,d.creationTime,d.data,{supportsWebRTC:d.supportsWebRTC})}})(window);
(function(k){var d="hasAudio hasVideo quality name videoDimensions orientation".split(" ");OT.Stream=function(f,e,a,b,c,h,g,l,k,m,p,q,s){var n;this.id=this.streamId=f;this.connection=e;this.name=a;this.data=b;this.type=c||"basic";this.creationTime=h?Number(h):null;this.hasAudio=OT.$.castToBoolean(g,!0);this.hasVideo=OT.$.castToBoolean(l,!0);this.peerId=m;this.quality=p;this.videoDimensions={width:q||640,height:s||480,orientation:k||OT.VideoOrientation.ROTATED_NORMAL};OT.$.eventing(this);this.update=
function(a,b){if(-1===d.indexOf(a))OT.warn('Unknown stream property "'+a+'" was modified to "'+b+'".');else{var c=this[a],e=b;switch(a){case "hasAudio":case "hasVideo":e=OT.$.castToBoolean(e,!0);this[a]=e;break;case "quality":case "name":this[a]=e;break;case "orientation":this.videoDimensions={width:e.width,height:e.height,orientation:e.videoOrientation}}c=new OT.StreamUpdatedEvent(this,a,c,e);this.dispatchEvent(c)}};this.destroy=function(a,b){n=a||"clientDisconnected";!0!==b&&this.dispatchEvent(new OT.DestroyedEvent("destroyed",
this,n))};Object.defineProperties(this,{destroyed:{get:function(){return void 0!==n},enumerable:!0},destroyedReason:{get:function(){return n},enumerable:!0}})}})(window);
(function(k){var d=k.mozRTCSessionDescription||k.RTCSessionDescription,f=k.mozRTCIceCandidate||k.RTCIceCandidate,e=function(a){return function(b){OT.debug("IceCandidateForwarder: Ice Candidate");b.candidate?a(OT.Raptor.Actions.CANDIDATE,b.candidate):OT.debug("IceCandidateForwarder: No more ICE candidates.")}},a=function(){var a=[],b=null;Object.defineProperty(this,"peerConnection",{set:function(a){b=a}});this.process=function(c){c=new f(c.candidate);b?b.addIceCandidate(c):a.push(c)};this.processPending=
function(){for(;a.length;)b.addIceCandidate(a.shift())}},b=function(a){var b=/a=rtpmap:(\d+) CN\/\d+/i,c=[],d,e;a=a.split("\r\n").filter(function(a,f){-1!==a.indexOf("m\x3daudio")&&(d=f);e=a.match(b);return null!==e?(c.push(e[1]),!1):!0});c.length&&d&&(a[d]=a[d].replace(RegExp(c.join("|"),"ig"),"").replace(/\s+/g," "));return a.join("\r\n")},c=function(a,c,d,e){var f=function(a){return function(b){e&&e(a,b)}},h=function(c){c.sdp=b(c.sdp);a.setLocalDescription(c,function(){d(c)},f("SetLocalDescription:Error while setting LocalDescription"))};
-1===c.sdp.indexOf("a\x3dcrypto")&&(c.sdp=c.sdp.replace(/^c=IN(.*)$/gmi,"c\x3dIN$1\r\na\x3dcrypto:1 AES_CM_128_HMAC_SHA1_80 inline:FakeFakeFakeFakeFakeFakeFakeFakeFakeFake\\r\\n"));-1===c.sdp.indexOf("a\x3drtcp-fb")&&(c.sdp=c.sdp.replace(/^m=video(.*)$/gmi,"m\x3dvideo$1\r\na\x3drtcp-fb:* ccm fir\r\na\x3drtcp-fb:* nack "));a.setRemoteDescription(c,function(b){a.createAnswer(h,f("CreateAnswer:Error while setting createAnswer"),null,!1)},f("SetRemoteDescription:Error while setting RemoteDescription"))},
h=function(a,c,d){var e={mandatory:{},optional:[]},f=function(a){return function(b){d&&d(a,b)}};navigator.mozGetUserMedia&&(e.mandatory.MozDontOfferDataChannel=!0);a.createOffer(function(d){d.sdp=b(d.sdp);a.setLocalDescription(d,function(){c(d)},f("SetLocalDescription:Error while setting LocalDescription"))},f("CreateOffer:Error while creating Offer"),e)};OT.PeerConnection=function(b){var f,r=new a,m,p,q="new",s=[],n,y=OT.$.now();OT.$.eventing(this);b.iceServers||(b.iceServers=[]);var w=function(a,
b){if(s.length)s[0](a,b)}.bind(this),u=function(){if(!f){try{OT.debug('Creating peer connection config "'+JSON.stringify(b)+'".'),f=OT.$.createPeerConnection(b,{optional:[{DtlsSrtpKeyAgreement:!0}]})}catch(a){return t("NewPeerConnection: "+a.message),null}r.peerConnection=f;f.onicecandidate=e(w);f.onaddstream=B.bind(this);f.onremovestream=E.bind(this);void 0!==f.onsignalingstatechange?f.onsignalingstatechange=x.bind(this):void 0!==f.onstatechange&&(f.onstatechange=x.bind(this));void 0!==f.oniceconnectionstatechange&&
(f.oniceconnectionstatechange=function(a){"failed"===a.target.iceConnectionState&&setTimeout(function(){"failed"===a.target.iceConnectionState&&t("ICEWorkflow:The stream was unable to connect due to a network error. Make sure your connection isn't blocked by a firewall.")},5E3)})}return f}.bind(this),v=function(){r&&(r.peerConnection=null);null!==f&&(f=null,this.trigger("close"))},x=function(a){a="string"===typeof a?a:a.target&&a.target.signalingState?a.target.signalingState:a.target.readyState;OT.debug("PeerConnection.stateChange: "+
a);if(a&&a.toLowerCase()!==q)switch(q=a.toLowerCase(),OT.debug("PeerConnection.stateChange: "+q),q){case "closed":v.call(this)}},B=function(a){this.trigger("streamAdded",a.stream)},E=function(a){this.trigger("streamRemoved",a.stream)},G=function(a){a=new d(a.sdp);u();_remoteDescriptionType=a.type;_remoteDescription=a;c(f,a,function(a){w(OT.Raptor.Actions.ANSWER,a)},function(a,b){t(a+":"+b+":PeerConnection.offerProcessor")})},F=function(a){a.sdp?(p=new d(a.sdp),_remoteDescriptionType=p.type,_remoteDescription=
p,f.setRemoteDescription(p,function(){OT.debug("setRemoteDescription succeeded")},function(a){t("SetRemoteDescription:Error while setting RemoteDescription: "+a)}),r.processPending()):OT.error("PeerConnection.processMessage: Weird message, no SDP.")},D=function(a){OT.debug("PeerConnection.processSubscribe: Sending offer to subscriber.");u();h(f,function(a){m=a;w(OT.Raptor.Actions.OFFER,m)},function(a,b){t(a+":"+b+": PeerConnection.suscribeProcessor")})},t=function(a){OT.error(a);this.trigger("error",
a)}.bind(this);this.addLocalStream=function(a){u();f.addStream(a)};this.disconnect=function(){r=null;if(f){var a=f.signalingState||f.readyState;a&&"closed"!==a.toLowerCase()&&f.close();v.call(this)}this.off()};this.processMessage=function(a,b){OT.debug("PeerConnection.processMessage: Received "+a+" from "+b.fromAddress);OT.debug(b);switch(a){case OT.Raptor.Actions.SUBSCRIBE:D.call(this,b);break;case OT.Raptor.Actions.OFFER:G.call(this,b);break;case OT.Raptor.Actions.ANSWER:F.call(this,b);break;case OT.Raptor.Actions.CANDIDATE:r.process(b);
break;default:OT.debug("PeerConnection.processMessage: Received an unexpected message of type "+a+" from "+b.fromAddress+": "+JSON.stringify(b))}return this};this.registerMessageDelegate=function(a){return s.push(a)};this.unregisterMessageDelegate=function(a){a=s.indexOf(a);-1!==a&&s.splice(a,1);return s.length};this.getStats=function(a,b){if(!0==n)OT.warn("PeerConnection.getStats: Already getting the stats!");else{n=!0;var c=OT.$.now(),d=(c-a.timeStamp)/1E3;a.timeStamp=c;var e=function(b){var c=
a.videoBytesTransferred||0;return b.bytesSent||b.bytesReceived?(a.videoBytesTransferred=b.bytesSent||b.bytesReceived,Math.round(8*(a.videoBytesTransferred-c)/d)):b.stat("googFrameHeightSent")?(a.videoBytesTransferred=b.stat("bytesSent"),Math.round(8*(a.videoBytesTransferred-c)/d)):b.stat("googFrameHeightReceived")?(a.videoBytesTransferred=b.stat("bytesReceived"),Math.round(8*(a.videoBytesTransferred-c)/d)):NaN},g=function(b){var c=a.audioBytesTransferred||0;return b.bytesSent||b.bytesReceived?(a.audioBytesTransferred=
b.bytesSent||b.bytesReceived,Math.round(8*(a.audioBytesTransferred-c)/d)):b.stat("audioInputLevel")?(a.audioBytesTransferred=b.stat("bytesSent"),Math.round(8*(a.audioBytesTransferred-c)/d)):b.stat("audioOutputLevel")?(a.audioBytesTransferred=b.stat("bytesReceived"),Math.round(8*(a.audioBytesTransferred-c)/d)):NaN},h={},m=function(a){if(a.result){a=a.result();for(var c=0;c<a.length;c++){var d=a[c];if(d.stat){"true"===d.stat("googActiveConnection")&&(h.localCandidateType=d.stat("googLocalCandidateType"),
h.remoteCandidateType=d.stat("googRemoteCandidateType"),h.transportType=d.stat("googTransportType"));var f=e(d);isNaN(f)||(h.avgVideoBitrate=f);d=g(d);isNaN(d)||(h.avgAudioBitrate=d)}}}n=!1;b(h)};h.duration=Math.round(c-y);var c=function(a){for(var c in a)if(a.hasOwnProperty(c)&&("outboundrtp"===a[c].type||"inboundrtp"===a[c].type)){var d=a[c];-1!==d.id.indexOf("video")?(d=e(d),isNaN(d)||(h.avgVideoBitrate=d)):-1!==d.id.indexOf("audio")&&(d=g(d),isNaN(d)||(h.avgAudioBitrate=d))}n=!1;b(h)},t=function(){var a=
k.navigator.userAgent.toLowerCase().match(/Firefox\/([0-9\.]+)/i),b=null!==a&&27<=parseFloat(a[1],10);t=function(){return b};return b};f&&f.getStats?t()?f.getStats(null,c,function(a){OT.warn("Error collecting stats",a);n=!1}):f.getStats(m):(n=!1,b(h))}};Object.defineProperty(this,"remoteStreams",{get:function(){var a;if(f){if(f.getRemoteStreams)a=f.getRemoteStreams();else if(f.remoteStreams)a=f.remoteStreams;else throw Error("Invalid Peer Connection object implements no method for retrieving remote streams");
a=Array.prototype.slice.call(a)}else a=[];return a}})}})(window);(function(k){var d={};OT.PeerConnections={add:function(f,e,a){f=f.id+"_"+e.id;(e=d[f])||(e=d[f]={count:0,pc:new OT.PeerConnection(a)});e.count+=1;return e.pc},remove:function(f,e){var a=f.id+"_"+e.id,b=d[a];b&&(b.count-=1,0===b.count&&(b.pc.disconnect(),delete d[a]))}}})(window);
(function(k){OT.PublisherPeerConnection=function(d,f,e,a){var b,c=!1,h=function(){this.destroy();this.trigger("disconnected",this)},g=function(a){this.trigger("error",null,a,this);this.destroy()},l=function(a,b){if(!c&&(a===OT.Raptor.Actions.CANDIDATE||a===OT.Raptor.Actions.OFFER||a===OT.Raptor.Actions.ANSWER||a===OT.Raptor.Actions.PRANSWER))c=-1!==(a===OT.Raptor.Actions.CANDIDATE?b.candidate:b.sdp).indexOf("typ relay");switch(a){case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:f._.jsepAnswer(d.id,
e,b);break;case OT.Raptor.Actions.OFFER:this.trigger("connected");f._.jsepOffer(d.id,e,b);break;case OT.Raptor.Actions.CANDIDATE:f._.jsepCandidate(d.id,e,b)}}.bind(this);OT.$.eventing(this);this.destroy=function(){b&&OT.PeerConnections.remove(d,e);b.off();b=null};this.processMessage=function(a,c){b.processMessage(a,c)};this.getStats=function(a,c){b.getStats(a,c)};this.init=function(){var k=f.sessionInfo.iceServers.map(function(a){a=OT.$.clone(a);"turn:"===a.url.trim().substr(0,5)&&(a.username=f.id+
"."+f.connection.id+"."+e.id);return a});b=OT.PeerConnections.add(d,e,{iceServers:k});b.on({close:h,error:g},this);b.registerMessageDelegate(l);b.addLocalStream(a);Object.defineProperty(this,"remoteConnection",{value:d});Object.defineProperty(this,"hasRelayCandidates",{get:function(){return c}})}}})(window);
(function(k){OT.SubscriberPeerConnection=function(d,f,e,a){var b,c=!1,h=function(){this.destroy();this.trigger("disconnected",this)},g=function(a){this.trigger("remoteStreamAdded",a,this)},l=function(a){this.trigger("remoteStreamRemoved",a,this)},k=function(a){this.trigger("error",null,a,this)},m=function(a,b){if(!c&&(a===OT.Raptor.Actions.CANDIDATE||a===OT.Raptor.Actions.OFFER||a===OT.Raptor.Actions.ANSWER||a===OT.Raptor.Actions.PRANSWER))c=-1!==(a===OT.Raptor.Actions.CANDIDATE?b.candidate:b.sdp).indexOf("typ relay");
switch(a){case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:this.trigger("connected");f._.jsepAnswer(d.id,e,b);break;case OT.Raptor.Actions.OFFER:f._.jsepOffer(d.id,e,b);break;case OT.Raptor.Actions.CANDIDATE:f._.jsepCandidate(d.id,e,b)}}.bind(this),p=function(a){var c="get"+(a?"Video":"Audio")+"Tracks";return function(a){var d=b.remoteStreams,e;if(0!==d.length&&d[0][c])for(var f=0,g=d.length;f<g;++f){e=d[f];e=e[c]();for(var h=0,l=e.length;h<l;++h)e[h].enabled=a}}};OT.$.eventing(this);
this.destroy=function(){b&&(0===b.unregisterMessageDelegate(m)&&(f&&(f.connected&&e&&!e.destroyed)&&f._.jsepUnsubscribe(e),this.subscribeToAudio(!1)),OT.PeerConnections.remove(d,e.streamId));b=null;this.off()};this.processMessage=function(a,c){b.processMessage(a,c)};this.getStats=function(a,c){b.getStats(a,c)};this.subscribeToAudio=p(!1);this.subscribeToVideo=p(!0);Object.defineProperty(this,"hasRelayCandidates",{get:function(){return c}});this.init=function(){var c=f.sessionInfo.iceServers.map(function(a){a=
OT.$.clone(a);"turn:"===a.url.trim().substr(0,5)&&(a.username=f.id+"."+f.connection.id+"."+e.id);return a});b=OT.PeerConnections.add(d,e.streamId,{iceServers:c});b.on({close:h,streamAdded:g,streamRemoved:l,error:k},this);c=b.registerMessageDelegate(m);0<b.remoteStreams.length?b.remoteStreams.forEach(g,this):1===c&&f._.jsepSubscribe(e,a.subscribeToVideo,a.subscribeToAudio)}}})(window);
(function(k){OT.Chrome=function(d){var f={},e=function(a,b){b.parent=this;b.appendTo(d.parent);f[a]=b;Object.defineProperty(this,a,{get:function(){return f[a]}})};d.parent&&(OT.$.eventing(this),this.destroy=function(){this.off();this.hide();for(var a in f)f[a].destroy()},this.show=function(){for(var a in f)f[a].show()},this.hide=function(){for(var a in f)f[a].hide()},this.set=function(a,b){if("string"===typeof a&&b)e.call(this,a,b);else for(var c in a)a.hasOwnProperty(c)&&e.call(this,c,a[c]);return this})}})(window);
(function(k){OT.Chrome.Behaviour||(OT.Chrome.Behaviour={});OT.Chrome.Behaviour.Widget=function(d,f){var e=f||{},a,b;d.setDisplayMode=function(c){c=c||"auto";a!==c&&(OT.$.removeClass(this.domElement,"OT_mode-"+a),OT.$.addClass(this.domElement,"OT_mode-"+c),b=a,a=c)};d.show=function(){this.setDisplayMode(b);if(e.onShow)e.onShow();return this};d.hide=function(){this.setDisplayMode("off");if(e.onHide)e.onHide();return this};d.destroy=function(){if(e.onDestroy)e.onDestroy(this.domElement);this.domElement&&
OT.$.removeElement(this.domElement);return d};d.appendTo=function(a){this.domElement=OT.$.createElement(e.nodeName||"div",e.htmlAttributes,e.htmlContent);if(e.onCreate)e.onCreate(this.domElement);"auto"!=e.mode?d.setDisplayMode(e.mode):(d.setDisplayMode("on"),setTimeout(function(){d.setDisplayMode(e.mode)},2E3));a.appendChild(this.domElement);return d}}})(window);
(function(k){OT.Chrome.NamePanel=function(d){var f=d.name;if(!f||""===f.trim().length)f=null,d.mode="off";var e;Object.defineProperty(this,"domElement",{get:function(){return e},set:function(a){e=a}});OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"h1",htmlContent:f,htmlAttributes:{className:"OT_name"}});Object.defineProperty(this,"name",{set:function(a){f||this.setDisplayMode("auto");f=a;e.innerHTML=f}.bind(this)})}})(window);
(function(k){OT.Chrome.MuteButton=function(d){var f,e=d.muted||!1,a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});var b=function(b){(e=!e)?(OT.$.addClass(a,"OT_active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"OT_active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:e?"OT_mute OT_active":"OT_mute"},onCreate:function(a){f=b.bind(this);
a.addEventListener("click",f,!1)}.bind(this),onDestroy:function(a){f=null;a.removeEventListener("click",f,!1)}.bind(this)})}})(window);
(function(k){OT.Chrome.MicVolume=function(d){var f,e=d.muted||!1,a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});var b=function(b){(e=!e)?(OT.$.addClass(a,"active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mic-volume"},onCreate:function(a){f=b.bind(this);a.addEventListener("click",
f,!1)}.bind(this),onDestroy:function(a){f=null;a.removeEventListener("click",f,!1)}.bind(this)})}})(window);
(function(k){OT.Chrome.SettingsPanelButton=function(d){var f,e=function(a){this.parent.trigger("SettingsPanel:open",this);return!1},a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"button",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:function(a){f=e.bind(this);a.addEventListener("click",f,!1)}.bind(this),onDestroy:function(a){f=null;a.removeEventListener("click",f,!1)}.bind(this)})}})(window);
(function(k){OT.Chrome.SettingsPanel=function(d){if(d.stream){var f=d.stream,e;Object.defineProperty(this,"domElement",{get:function(){return e},set:function(a){e=a}});var a=function(){var a=f.getVideoTracks().length?f.getVideoTracks()[0].label:"None",d=f.getAudioTracks().length?f.getAudioTracks()[0].label:"None";e.innerHTML="\x3cdl\x3e                                        \x3cdt\x3eCam\x3c/dt\x3e                                        \x3cdd\x3e"+a+"\x3c/dd\x3e                                        \x3cdt\x3eMic\x3c/dt\x3e                                        \x3cdd\x3e"+
d+"\x3c/dd\x3e                                    \x3c/dl\x3e";a=OT.$.createButton("Close",{className:"OT_close"},{click:b.bind(this)});e.appendChild(a)},b=function(){this.parent.trigger("SettingsPanel:close",this);return!1};OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"section",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:a.bind(this),onShow:function(){a.call(this)}.bind(this)})}}})(window);
(function(k){OT.Chrome.OpenTokButton=function(d){var f;this.__defineGetter__("domElement",function(){return f});this.__defineSetter__("domElement",function(d){f=d});OT.Chrome.Behaviour.Widget(this,{mode:d?d.mode:null,nodeName:"span",htmlContent:"OpenTok",htmlAttributes:{className:"OT_opentok"}})}})(window);
(function(k){OT.StylableComponent=function(f,e){if(!f.trigger)throw Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var a=new d(e,function(a,c,d){d?f.trigger("styleValueChanged",a,c,d):f.trigger("styleValueChanged",a,c)});f.getStyle=function(b){return a.get(b)};f.setStyle=function(b,c,d){"string"!==typeof b?a.setAll(b,d):a.set(b,c);return this}};var d=function(d,e){var a="showMicButton showSpeakerButton showSettingsButton showCameraToggleButton nameDisplayMode buttonDisplayMode showSaveButton showRecordButton showRecordStopButton showReRecordButton showPauseButton showPlayButton showPlayStopButton showStopButton backgroundImageURI showControlPanel showRecordCounter showPlayCounter showControlBar showPreviewTime".split(" "),
b={buttonDisplayMode:["auto","off","on"],nameDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],showCameraToggleButton:[!0,!1],showSaveButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showPlayCounter:[!0,!1],showRecordCounter:[!0,!1],showPreviewTime:[!0,!1]},c={},h=function(a,c){return"backgroundImageURI"===a||b.hasOwnProperty(a)&&-1!==b[a].indexOf(c)},g=function(a){switch(a){case "true":return!0;case "false":return!1;default:return a}};this.getAll=function(){var b=
OT.$.clone(c),d;for(d in b)0>a.indexOf(d)&&delete b[d];return b};this.get=function(a){return a?c[a]:this.getAll()};this.setAll=function(a,b){var d,f,k;for(k in a)f=g(a[k]),h(k,f)?(d=c[k],f!==d&&(c[k]=f,b||e(k,f,d))):OT.warn("Style.setAll::Invalid style property passed "+k+" : "+f);return this};this.set=function(a,b){OT.debug("Publisher.setStyle: "+a.toString());var d=g(b),f;if(!h(a,d))return OT.warn("Style.set::Invalid style property passed "+a+" : "+d),this;f=c[a];d!==f&&(c[a]=d,e(a,b,f));return this};
d&&this.setAll(d,!0)}})(window);(function(k){OT.Microphone=function(d,f){var e,a=50;Object.defineProperty(this,"muted",{get:function(){return e},set:function(a){if(e!==a){e=a;a=d.getAudioTracks();for(var c=0,f=a.length;c<f;++c)a[c].enabled=!e}}});Object.defineProperty(this,"gain",{get:function(){return a},set:function(b){OT.warn("OT.Microphone.gain IS NOT YET IMPLEMENTED");a=b}});void 0!==f?this.muted=!0===f:d.getAudioTracks().length?this.muted=!d.getAudioTracks()[0].enabled:this.muted=!1}})(window);
(function(k){OT.generateSimpleStateMachine=function(d,f,e){var a=f.slice(),b=OT.$.clone(e);return function(c){function f(a,b){c({message:a,newState:b,currentState:e,previousState:l})}var e=d,l=null;this.set=function(c){var d;-1!==a.indexOf(c)?b[e]&&-1!==b[e].indexOf(c)?d=!0:(f("'"+e+"' cannot transition to '"+c+"'",c),d=!1):(f("'"+c+"' is not a valid state",c),d=!1);d&&(l=e,e=c)};Object.defineProperties(this,{current:{get:function(){return e}},subscribing:{get:function(){return"Subscribing"===e}}})}}})(window);
(function(k){OT.SubscribingState=OT.generateSimpleStateMachine("NotSubscribing","NotSubscribing Init ConnectingToPeer BindingRemoteStream Subscribing Failed".split(" "),{NotSubscribing:["NotSubscribing","Init"],Init:["NotSubscribing","ConnectingToPeer","BindingRemoteStream"],ConnectingToPeer:["NotSubscribing","BindingRemoteStream","Failed"],BindingRemoteStream:["NotSubscribing","Subscribing","Failed"],Subscribing:["NotSubscribing","Failed"],Failed:[]});Object.defineProperty(OT.SubscribingState.prototype,
"attemptingToSubscribe",{get:function(){return-1!==["Init","ConnectingToPeer","BindingRemoteStream"].indexOf(this.current)}})})(window);
(function(k){OT.PublishingState=OT.generateSimpleStateMachine("NotPublishing","NotPublishing GetUserMedia BindingMedia MediaBound PublishingToSession Publishing Failed".split(" "),{NotPublishing:["NotPublishing","GetUserMedia"],GetUserMedia:["BindingMedia","Failed","NotPublishing"],BindingMedia:["MediaBound","Failed","NotPublishing"],MediaBound:["NotPublishing","PublishingToSession","Failed"],PublishingToSession:["NotPublishing","Publishing","Failed"],Publishing:["NotPublishing","MediaBound","Failed"],
Failed:[]});Object.defineProperties(OT.PublishingState.prototype,{attemptingToPublish:{get:function(){return-1!==["GetUserMedia","BindingMedia","MediaBound","PublishingToSession"].indexOf(this.current)}},publishing:{get:function(){return"Publishing"===this.current}}})})(window);
(function(k){var d={audio:!0,video:!0};OT.Publisher=function(){if(OT.checkSystemRequirements()){var f=OT.Publisher.nextId(),e,a,b,c,h,g,l={},r=!1,m,p,q,s,n,y=new OT.Analytics,w={},u={timeStamp:OT.$.now()},v;OT.$.eventing(this);OT.StylableComponent(this,{showMicButton:!0,showSettingsButton:!0,showCameraToggleButton:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var x=function(a,b,d,e){y.logEvent({action:a,variation:b,payload_type:d,payload:e,session_id:g?g.sessionId:null,
connection_id:g&&g.connected?g.connection.connectionId:null,partner_id:g?g.apiKey:OT.APIKEY,streamId:c?c.id:null,widget_id:f,widget_type:"Publisher"})},B=function(b){var d={widget_type:"Publisher",stream_type:"WebRTC",width:a?OT.$.width(a.domElement):void 0,height:a?OT.$.height(a.domElement):void 0,sessionId:g?g.sessionId:null,connectionId:g&&g.connected?g.connection.connectionId:null,partnerId:g?g.apiKey:OT.APIKEY,streamId:c?c.id:null,widgetId:f,version:OT.properties.version,media_server_name:g?
g.sessionInfo.messagingServer:null,p2pFlag:g?g.sessionInfo.p2pEnabled:!1,duration:(new Date).getTime()-p.getTime(),remote_connection_id:b};l[b].getStats(u,function(a){if(a)for(var b in a)d[b]=a[b];y.logQOS(d)})},E=function(){OT.debug("OT.Publisher.onLoaded");v.set("MediaBound");a.loading=!1;r=!0;n=(new OT.Chrome({parent:a.domElement})).set({name:new OT.Chrome.NamePanel({name:m.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new OT.Chrome.MuteButton({muted:!1===m.publishAudio,mode:z.call(this,
this.getStyle("showMicButton"))}),opentokButton:new OT.Chrome.OpenTokButton}).on({muted:this.publishAudio.bind(this,!1),unmuted:this.publishAudio.bind(this,!0)});this.trigger("initSuccess",this);this.trigger("loaded",this)},G=function(a){x("publish","Failure","reason","Publisher PeerConnection Error: "+a);v.set("Failed");this.trigger("publishError","Publisher PeerConnection Error: "+a);OT.handleJsException("Publisher PeerConnection Error: "+a,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:g,target:this})},
F=function(c){OT.debug("OT.Publisher.onStreamAvailable");v.set("BindingMedia");h&&(h.stop(),h=null);h=c;s=new OT.Microphone(h,!m.publishAudio);this.publishVideo(m.publishVideo);this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_ALLOWED,!1));b=new OT.VideoElement({attributes:{muted:!0}});b.on({streamBound:E,loadError:G,error:N},this).bindToStream(h);a.video=b},D=function(b){OT.error("OT.Publisher.onStreamAvailableError "+b.name+": "+b.message);v.set("Failed");this.trigger("publishError",b.message);
a&&a.destroy();x("publish","Failure","reason","Publisher failed to access camera/mic: "+b.message);OT.handleJsException("Publisher failed to access camera/mic: "+b.message,2E3,{session:g,target:this})},t=function(b){OT.error("OT.Publisher.onStreamAvailableError Permission Denied");v.set("Failed");this.trigger("publishError",b.message);x("publish","Failure","reason","Publisher Access Denied: Permission Denied");var c=OT.$.browserVersion(),d=new OT.Event(OT.Event.names.ACCESS_DENIED);this.dispatchEvent(d,
function(){d.isDefaultPrevented()||("Chrome"===c.browser?(a&&a.addError("",null,"OT_publisher-denied-chrome"),M?OT.Dialogs.AllowDeny.Chrome.deniedNow():OT.Dialogs.AllowDeny.Chrome.previouslyDenied(k.location.hostname)):"Firefox"===c.browser&&(a&&a.addError("","Click the reload button in the URL bar to change camera \x26 mic settings.","OT_publisher-denied-firefox"),OT.Dialogs.AllowDeny.Firefox.denied().on({refresh:function(){k.location.reload()}})))})},C,H,I,M=!1,Q=function(){M=!0;x("accessDialog",
"Opened","","");var a=OT.$.browserVersion();this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_OPENED,!0),function(b){b.isDefaultPrevented()||("Chrome"===a.browser?H=setTimeout(function(){C=OT.Dialogs.AllowDeny.Chrome.initialPrompt()},5E3):"Firefox"===a.browser&&(I=setTimeout(function(){C=OT.Dialogs.AllowDeny.Firefox.maybeDenied()},7E3)))})},R=function(){x("accessDialog","Closed","","");H&&(clearTimeout(H),H=null);I&&(clearTimeout(I),I=null);C&&(C.close(),C=null);this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_CLOSED,
!1))},N=function(a,b){OT.error("OT.Publisher.onVideoError");var c=b+(a?" ("+a+")":"");x("stream",null,"reason","Publisher while playing stream: "+c);v.set("Failed");v.attemptingToPublish?this.trigger("publishError",c):this.trigger("error",c);OT.handleJsException("Publisher error playing stream: "+c,2E3,{session:g,target:this})},O=function(a){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");this.cleanupSubscriber(a.remoteConnection.id)},K=function(a,b,c){x("publish",
"Failure","reason|hasRelayCandidates",[b+": Publisher PeerConnection with connection "+(c&&c.remoteConnection&&c.remoteConnection.id)+" failed",c.hasRelayCandidates].join("|"));OT.handleJsException("Publisher PeerConnection Error: "+b,2E3,{session:g,target:this});c.remoteConnection&&(clearInterval(w[c.remoteConnection.id]),delete w[c.remoteConnection.id],delete l[c.remoteConnection.id]);c.off()},L=function(a){var b=l[a.id];if(!b){var d=OT.$.now();x("createPeerConnection","Attempt","","");a.on("destroyed",
this.cleanupSubscriber.bind(this,a.id));b=l[a.id]=new OT.PublisherPeerConnection(a,g,c,h);b.on({connected:function(){x("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(OT.$.now()-d,10),b.hasRelayCandidates].join("|"));w[a.id]=setInterval(function(){B(a.id)},3E4)},disconnected:O,error:K},this);b.init()}return b},z=function(a){if(!1===a)return"off";a=this.getStyle("buttonDisplayMode");return!1===a?"on":a},J=function(){n&&(n.destroy(),n=null);this.disconnect();s=null;b&&(b.destroy(),
b=null);h&&(h.stop(),h=null);a&&(a.destroy(),a=null);this.session&&this._.unpublishFromSession(this.session);for(var d in w)clearInterval(w[d]),delete w[d];c=e=null;r=!1;_properties=g=null;v.set("NotPublishing")}.bind(this);this.publish=function(b,c){OT.debug("OT.Publisher: publish");(v.attemptingToPublish||v.publishing)&&J();v.set("GetUserMedia");m=OT.$.defaults(c||{},{publishAudio:!0,publishVideo:!0,mirror:!0});m.constraints=OT.$.defaults(m.constraints||{},d);m.style&&this.setStyle(m.style,null,
!0);m.name&&(m.name=m.name.toString());m.classNames="OT_root OT_publisher";OT.onLoad(function(){a=new OT.WidgetView(b,m);e=a.domId;OT.$.shouldAskForDevices(function(a){a.video||(OT.warn("Setting video constraint to false, there are no video sources"),m.constraints.video=!1);a.audio||(OT.warn("Setting audio constraint to false, there are no audio sources"),m.constraints.audio=!1);OT.$.getUserMedia(m.constraints,F.bind(this),D.bind(this),Q.bind(this),R.bind(this),t.bind(this))}.bind(this))},this);return this};
this.publishAudio=function(a){m.publishAudio=a;s&&(s.muted=!a);g&&c&&g._.modifyStream(c.streamId,"hasAudio",a);return this};this.publishVideo=function(b){var d=m.publishVideo;m.publishVideo=b;g&&(c&&m.publishVideo!==d)&&g._.modifyStream(c.streamId,"hasVideo",b);if(h)for(var d=h.getVideoTracks(),f=0,e=d.length;f<e;++f)d[f].enabled=b;a&&(a.showPoster=!b);return this};this.recordQOS=function(){for(var a in l)B(a)};this.destroy=function(a,b){J();!0!==b&&this.dispatchEvent(new OT.DestroyedEvent(OT.Event.names.PUBLISHER_DESTROYED,
this,a),this.off.bind(this));return this};this.disconnect=function(){for(var a in l)this.cleanupSubscriber(a)};this.cleanupSubscriber=function(a){var b=l[a];clearInterval(w[a]);delete w[a];b&&(b.destroy(),delete l[a],x("disconnect","PeerConnection","subscriberConnection",a))};this.processMessage=function(a,b,c){OT.debug("OT.Publisher.processMessage: Received "+a+" from "+b.id);OT.debug(c);switch(a){case OT.Raptor.Actions.UNSUBSCRIBE:this.cleanupSubscriber(b.id);break;default:L.call(this,b).processMessage(a,
c)}};this.getImgData=function(){return!r?(OT.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null):b.imgData};this._={publishToSession:function(a){this.session=a;var c=function(){this.session&&(v.set("PublishingToSession"),q&&clearTimeout(q),q=setTimeout(function(){x("publish","Failure","reason","StreamCreated: Timed out waiting for streamRegistered");this.trigger("publishError","StreamCreated: Timed out waiting for streamRegistered")}.bind(this),3E4),a._.createStream(this.guid,
m&&m.name?m.name:"",OT.VideoOrientation.ROTATED_NORMAL,b.videoWidth,b.videoHeight,m.publishAudio,m.publishVideo))};if(r)c.call(this);else this.on("initSuccess",c,this);x("publish","Attempt","streamType","WebRTC");return this}.bind(this),unpublishFromSession:function(a){if(!this.session||a.id!==this.session.id)return OT.warn("The publisher "+this.guid+" is trying to unpublish from a session "+a.id+" it is not attached to"),this;a.connected&&this.stream&&a._.destroyStream(this.stream.id);this.disconnect();
this.session=null;v.set("MediaBound");x("unpublish","Success","sessionId",a.id);return this}.bind(this),streamRegisteredHandler:function(a){clearTimeout(q);q=null;this.stream=a;this.stream.on("destroyed",this.disconnect,this);x("publish","Success","streamType","WebRTC");a=f;f=OT.Publisher.nextId();a&&this.trigger("idUpdated",a,f);v.set("Publishing");p=new Date;this.trigger("publishSuccess")}.bind(this)};this.detectDevices=function(){OT.warn("Fixme: Haven't implemented detectDevices")};this.detectMicActivity=
function(){OT.warn("Fixme: Haven't implemented detectMicActivity")};this.getEchoCancellationMode=function(){OT.warn("Fixme: Haven't implemented getEchoCancellationMode");return"fullDuplex"};this.setMicrophoneGain=function(a){OT.warn("Fixme: Haven't implemented setMicrophoneGain")};this.getMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented getMicrophoneGain");return 0.5};this.setCamera=function(a){OT.warn("Fixme: Haven't implemented setCamera")};this.setMicrophone=function(a){OT.warn("Fixme: Haven't implemented setMicrophone")};
Object.defineProperties(this,{id:{get:function(){return e},enumerable:!0},guid:{get:function(){return f},enumerable:!0},stream:{get:function(){return c},set:function(a){c=a},enumerable:!0},streamId:{get:function(){return!c?null:c.id},enumerable:!0},targetElement:{get:function(){return b.domElement}},domId:{get:function(){return e}},session:{get:function(){return g},set:function(a){g=a},enumerable:!0},isWebRTC:{get:function(){return!0}},loading:{get:function(){return a&&a.loading}}});Object.defineProperty(this._,
"webRtcStream",{get:function(){return h}});this.on("styleValueChanged",function(a,b,c){if(n)switch(a){case "nameDisplayMode":n.name.setDisplayMode(b)}},this);v=new OT.PublishingState(function(a){OT.error("Publisher State Change Failed: ",a.message);OT.debug(a)})}else OT.upgradeSystemRequirements()};OT.Publisher.nextId=OT.$.uuid})(window);
(function(k){OT.Subscriber=function(d,f){var e=OT.$.uuid(),a=d||e,b,c,h,g,l,k,m=f.session,p,q,s,n=OT.$.clone(f),y=new OT.Analytics,w=50,u,v,x={timeStamp:OT.$.now()};if(m){OT.$.eventing(this);OT.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var B=function(a,b,c,d){y.logEvent({action:a,variation:b,payload_type:c,payload:d,stream_id:g?g.id:null,session_id:m?m.sessionId:null,connection_id:m&&m.connected?m.connection.connectionId:null,partner_id:m&&m.connected?
m.sessionInfo.partnerId:null,widget_id:e,widget_type:"Subscriber"})},E=function(){if(u.subscribing&&m&&m.connected){var a={widget_type:"Subscriber",stream_type:"WebRTC",width:b?OT.$.width(b.domElement):void 0,height:b?OT.$.height(b.domElement):void 0,session_id:m?m.sessionId:null,connectionId:m?m.connection.connectionId:null,media_server_name:m?m.sessionInfo.messagingServer:null,p2pFlag:m?m.sessionInfo.p2pEnabled:!1,partner_id:m?m.apiKey:null,stream_id:g.id,widget_id:e,version:OT.properties.version,
duration:parseInt(OT.$.now()-p,10),remote_connection_id:g.connection.connectionId};k.getStats(x,function(b){if(b)for(stat_index in b)a[stat_index]=b[stat_index];y.logQOS(a)})}},G=function(){!u.subscribing&&c&&(OT.debug("OT.Subscriber.onLoaded"),u.set("Subscribing"),p=OT.$.now(),B("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(p-q,10),k&&k.hasRelayCandidates].join("|")),s=setInterval(E,3E4),v&&(v=null,this.subscribeToVideo(!1)),b.loading=!1,I.call(this),this.trigger("subscribeSuccess",
this),this.trigger("loaded",this),B("subscribe","Success","streamId",g.id))},F=function(){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");u.attemptingToSubscribe?(u.set("Failed"),this.trigger("subscribeError","ClientDisconnected")):u.subscribing&&u.set("Failed");this.disconnect()},D=function(a,c){u.attemptingToSubscribe?(B("createPeerConnection","Failure","reason|hasRelayCandidates",["Subscriber PeerConnection Error: "+c,k&&k.hasRelayCandidates].join("|")),u.set("Failed"),
this.trigger("subscribeError",c)):u.subscribing&&(u.set("Failed"),this.trigger("error",c));this.disconnect();B("subscribe","Failure","reason",c+":Subscriber PeerConnection Error");OT.handleJsException("Subscriber PeerConnection Error: "+c,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:m,target:this});b&&b.addError("The stream was unable to connect due to a network error.","Make sure your connection isn't blocked by a firewall.")},t=function(a){OT.debug("OT.Subscriber.onRemoteStreamAdded");u.set("BindingRemoteStream");
this.subscribeToAudio(n.subscribeToAudio);var d=v;this.subscribeToVideo(n.subscribeToVideo);v=d;d=new OT.VideoElement;d.setAudioVolume(w);d.on({streamBound:G,loadError:D,error:D},this);d.bindToStream(a);c=b.video=d;c.orientation={width:g.videoDimensions.width,height:g.videoDimensions.height,videoOrientation:g.videoDimensions.orientation};B("createPeerConnection","StreamAdded","","");this.trigger("streamAdded",this)},C=function(a){OT.debug("OT.Subscriber.onStreamRemoved");c.stream==a&&(c.destroy(),
c=null);this.trigger("streamRemoved",this)},H=function(a){switch(a.changedProperty){case "orientation":c.orientation={width:g.videoDimensions.width,height:g.videoDimensions.height,videoOrientation:g.videoDimensions.orientation};break;case "hasVideo":b&&(b.showPoster=!(g.hasVideo&&n.subscribeToVideo))}},I=function(){h=(new OT.Chrome({parent:b.domElement})).set({name:new OT.Chrome.NamePanel({name:n.name,mode:this.getStyle("nameDisplayMode")}),opentokButton:new OT.Chrome.OpenTokButton}).on({muted:function(){},
unmuted:function(){}})};this.recordQOS=function(){E()};this.subscribe=function(c){OT.debug("OT.Subscriber: subscribe to "+c.id);if(u.subscribing)return OT.error("OT.Subscriber.Subscribe: Cannot subscribe, already subscribing."),!1;u.set("Init");if(!c)return OT.error("OT.Subscriber: No stream parameter."),!1;if(g)return OT.error("OT.Subscriber: Already subscribed"),!1;g=c;g.on({updated:H,destroyed:this.disconnect},this);l=c.connection.connectionId;n.name=g.name;n.classNames="OT_root OT_subscriber";
n.style&&this.setStyle(n.style,null,!0);n.audioVolume&&this.setAudioVolume(n.audioVolume);n.subscribeToAudio=OT.$.castToBoolean(n.subscribeToAudio,!0);n.subscribeToVideo=OT.$.castToBoolean(n.subscribeToVideo,!0);b=new OT.WidgetView(d,n);a=b.domId;!n.subscribeToVideo&&"Chrome"==OT.$.browser()&&(v=!0,n.subscribeToVideo=!0);q=OT.$.now();g.connection.id!==m.connection.id?(B("createPeerConnection","Attempt","",""),u.set("ConnectingToPeer"),k=new OT.SubscriberPeerConnection(g.connection,m,g,n),k.on({disconnected:F,
error:D,remoteStreamAdded:t,remoteStreamRemoved:C},this),k.init()):(B("createPeerConnection","Attempt","",""),t.call(this,m.getPublisherForStream(g)._.webRtcStream));B("subscribe","Attempt","streamId",g.id);return this};this.destroy=function(c,d){clearInterval(s);s=null;this.disconnect();h&&(h.destroy(),h=null);b&&(b.destroy(),b=null);g&&!g.destroyed&&B("unsubscribe",null,"streamId",g.id);n=m=g=a=null;!0!==d&&this.dispatchEvent(new OT.DestroyedEvent(OT.Event.names.SUBSCRIBER_DESTROYED,this,c),this.off.bind(this));
return this};this.disconnect=function(){u.set("NotSubscribing");c&&(c.destroy(),c=null);k&&(k.destroy(),k=null,B("disconnect","PeerConnection","streamId",g.id))};this.processMessage=function(a,b,c){OT.debug("OT.Subscriber.processMessage: Received "+a+" message from "+b.id);OT.debug(c);l!=b.id&&(l=b.id);k&&k.processMessage(a,c)};this.updateQuality=function(a){OT.warn("Due to high packet loss and low bandwidth, video has been disabled");this.subscribeToVideo(!1);this.dispatchEvent(new OT.Event("videoDisabled"))};
this.getImgData=function(){return!this.subscribing?(OT.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null):c.imgData};this.setAudioVolume=function(a){a=parseInt(a,10);if(isNaN(a))return OT.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),this;w=Math.max(0,Math.min(100,a));w!=a&&OT.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100");c&&c.setAudioVolume(w);return this};this.getAudioVolume=
function(){return c?c.getAudioVolume():w};this.subscribeToAudio=function(a){a=OT.$.castToBoolean(a,!0);k&&(k.subscribeToAudio(a),m&&(g&&a!==n.subscribeToAudio)&&m._.modifySubscriber(this,"hasAudio",a));n.subscribeToAudio=a;return this};this.subscribeToVideo=function(a){if(v&&!0==a)v=!1;else return a=OT.$.castToBoolean(a,!0),b&&(b.showPoster=!(a&&g.hasVideo),a&&b.video&&(b.loading=a,b.video.whenTimeIncrements(function(){b.loading=!1},this))),k&&(k.subscribeToVideo(a),m&&(g&&a!==n.subscribeToVideo)&&
m._.modifySubscriber(this,"hasVideo",a)),n.subscribeToVideo=a,this};Object.defineProperties(this,{id:{get:function(){return a},enumerable:!0},widgetId:{get:function(){return e}},stream:{get:function(){return g},enumerable:!0},streamId:{get:function(){return!g?null:g.id},enumerable:!0},targetElement:{get:function(){return c?c.domElement:null}},subscribing:{get:function(){return u.subscribing},enumerable:!0},isWebRTC:{get:function(){return!0}},loading:{get:function(){return b&&b.loading}},session:{get:function(){return m}}});
this.on("styleValueChanged",function(a,b,c){if(h)switch(a){case "nameDisplayMode":h.name.setDisplayMode(b)}},this);u=new OT.SubscribingState(function(a){OT.error("Subscriber State Change Failed: ",a.message);OT.debug(a)})}else OT.handleJsException("Subscriber must be passed a session option",2E3,{session:m,target:this})}})(window);
(function(k){OT.SessionInfo=function(d){var e=null;this.sessionStatus=this.partnerId=this.sessionId=null;this.p2pEnabled=!1;this.iceServers=this.messagingServer=null;OT.log("SessionInfo Response:");OT.log(d);d&&(d.documentElement&&null!==d.documentElement.firstElementChild)&&(e=d.documentElement.firstElementChild);d=e.firstElementChild;do switch(d.localName){case "session_id":this.sessionId=d.textContent;break;case "partner_id":this.partnerId=d.textContent;break;case "session_status":this.sessionStatus=
d.textContent;break;case "messaging_server_url":this.messagingServer=d.textContent;break;case "ice_servers":this.iceServers=normaliseIceServers(parseIceServersXml(d.childNodes));break;case "properties":if(e=d.firstElementChild){do if("p2p"===e.localName&&null!==e.firstElementChild){this.p2pEnabled="enabled"===e.firstElementChild.textContent;break}while(e=e.nextElementSibling)}}while(d=d.nextElementSibling);if(!this.iceServers||0===this.iceServers.length)OT.warn("SessionInfo contained not ICE Servers, using the default"),
this.iceServers=[{url:"stun:stun.l.google.com:19302"}]};OT.SessionInfo.get=function(d,e,a){var b=OT.properties.apiURL+"/session/"+d.id+"?extended\x3dtrue",c=OT.$.now();d.logEvent("getSessionInfo","Attempt","api_url",OT.properties.apiURL);OT.$.getXML(b,{headers:{"X-TB-TOKEN-AUTH":d.token,"X-TB-VERSION":1},success:function(b,g){var k=g.target.responseText;d.logEvent("Instrumentation",null,"gsi",OT.$.now()-c);k=parseErrorFromXMLDocument(b,k);!1===k?onGetResponseCallback(d,e,b):onGetErrorCallback(d,a,
k)},error:function(b){onGetErrorCallback(d,a,parseErrorFromXMLDocument(b.target.responseXML,b.target.responseText))}})};var d={};d["404"]=OT.ExceptionCodes.INVALID_SESSION_ID;d["400"]=OT.ExceptionCodes.INVALID_SESSION_ID;d["409"]=OT.ExceptionCodes.INVALID_SESSION_ID;d["403"]=OT.ExceptionCodes.AUTHENTICATION_ERROR;parseErrorFromXMLDocument=function(d,e){if(d&&d.documentElement&&null!==d.documentElement.firstElementChild){var a=d.evaluate("//error",d.documentElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
null),b=a.snapshotLength;if(0===b)return!1;for(;0<b;)return a=a.snapshotItem(0),{code:a.getAttribute("code"),message:a.firstElementChild.getAttribute("message")}}return{code:null,message:"Unknown error: getSessionInfo XML response was badly formed "+e.substring(0,1E3)}};onGetResponseCallback=function(d,e,a){d.logEvent("getSessionInfo","Success","api_url",OT.properties.apiURL);e(new OT.SessionInfo(a))};onGetErrorCallback=function(f,e,a){TB.handleJsException("TB.SessionInfoError :: Unable to get session info "+
a.message,d[a.code],{session:f});f.logEvent("Connect","Failure","errorMessage","GetSessionInfo:"+d[a.code]+": Unable to get session info "+a.message);e(a,f)};parseIceServersXml=function(d){for(var e=[],a,b,c=0,h=d.length;c<h;++c)"ice_server"===d[c].localName&&(b=d[c].attributes,a={url:b.getNamedItem("url").nodeValue},b.getNamedItem("credential")&&b.getNamedItem("credential").nodeValue.length&&(a.credential=b.getNamedItem("credential").nodeValue),e.push(a));return e};normaliseIceServers=function(d){var e=
navigator.userAgent.match(/(Firefox)\/([0-9]+\.[0-9]+)/),a=e?parseFloat(e[2],10):void 0,b;return d.map(function(c){if("turn:"!==c.url.trim().substr(0,5))return c;if(null!==e){if(25>a)return{url:c.url.replace("turn:","stun:")};27>a&&-1!==c.url.indexOf("?")&&(c.url=c.url.trim().split("?")[0])}b=c.url.trim().split(/[:@]/);return{username:b[1],credential:c.credential,url:b[0]+":"+b[2]+(4===b.length?":"+b[3]:"")}})}})(window);
(function(k){OT.Capabilities=function(d){this.publish=-1!==d.indexOf("publish")?1:0;this.subscribe=-1!==d.indexOf("subscribe")?1:0;this.forceUnpublish=-1!==d.indexOf("forceunpublish")?1:0;this.forceDisconnect=-1!==d.indexOf("forcedisconnect")?1:0;this.supportsWebRTC=OT.$.supportsWebRTC()?1:0}})(window);
(function(k){var d=function(d,e,a,b){var c,h={},g=function(){clearTimeout(c);d.off("exception",k)},k=function(a){h.hasOwnProperty(a.code)&&this.failed(h[a.code])};this.failsOnExceptionCodes=function(a){h=a};this.succeeded=function(){g();completionHandler&&OT.$.callAsync(completionHandler,null)};this.failed=function(a){g();completionHandler&&OT.$.callAsync(completionHandler,new OT.Error(null,a))};d.on("exception",k,this);c=setTimeout(function(){this.failed(b&&b.timeoutMessage?b.timeoutMessage:"Timed out while waiting for the server to respond.")}.bind(this),
3E4)};OT.Session=function(f){if(OT.checkSystemRequirements()){var e=!0,a,b,c,h=OT.$.uuid(),g=new OT.Analytics,l,r={},m={};OT.$.eventing(this);var p=OT.$.statable(this,["disconnected","connecting","connected","disconnecting"],"disconnected");this.connections=new OT.Collection;this.streams=new OT.Collection;var q=function(a,b){p("disconnected");OT.error(a);this.trigger("sessionConnectFailed",a);TB.handleJsException(a,b||OT.ExceptionCodes.CONNECT_FAILED,{session:this})},s=function(a){var b=a.reason;
"networkTimedout"==b?(b="networkDisconnected",this.logEvent("Connect","TimeOutDisconnect","reason",a.reason)):this.logEvent("Connect","Disconnected","reason",a.reason);var c=new OT.SessionDisconnectEvent("sessionDisconnected",b);x.call(this);B.call(this);a=function(){c.isDefaultPrevented()||E.call(this,c.reason)}.bind(this);this.dispatchEvent(c,a)},n=function(a){a.id.match(/^symphony\./)||this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_CREATED,[a]))},y=function(a,b){if(!a.id.match(/^symphony\./)&&
a.id!==c.id){if(r[a.id]){var d=r[a.id];delete r[a.id];"forceDisconnected"!==b&&OT.warn("Expected a forceDisconnect for connection "+a.id+", but a "+b+" was received instead.");d.succeeded()}this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_DESTROYED,[a],b))}},w=function(a){this.dispatchEvent(new OT.StreamEvent(OT.Event.names.STREAM_CREATED,[a]))},u=function(a){var b=a.target,c=a.changedProperty,d=a.newValue;"orientation"===c&&(c="videoDimensions",d={width:d.width,height:d.height});
this.dispatchEvent(new OT.StreamPropertyChangedEvent(OT.Event.names.STREAM_PROPERTY_CHANGED,b,c,a.oldValue,d))},v=function(a,b){if(m[a.id]){var c=m[a.id];delete m[a.id];"forceUnpublished"!==b&&OT.warn("Expected a forceUnpublish for stream "+a.id+", but a "+b+" destroyed was received instead.");c.succeeded()}var d=new OT.StreamEvent("streamDestroyed",[a],b),c=function(){if(!d.isDefaultPrevented()){var b=OT.publishers.where({streamId:a.id})[0];b&&(b._.unpublishFromSession(this),b.destroy());OT.subscribers.where({streamId:a.id}).forEach(function(a){a.session.id===
this.id&&this.unsubscribe(a)},this)}}.bind(this);this.dispatchEvent(d,c)},x=function(){b=a=null;p("disconnected");this.connections.destroy();this.streams.destroy()},B=function(){OT.publishers.where({session:this}).forEach(function(a){a.disconnect()});OT.subscribers.where({session:this}).forEach(function(a){a.disconnect()})},E=function(a){OT.publishers.where({session:this}).forEach(function(b){b.destroy(a)});OT.subscribers.where({session:this}).forEach(function(b){b.destroy(a)})},G=function(){TB.debug("OT.Session: connecting to Raptor");
c=new OT.Raptor.Socket(h,this.sessionInfo.messagingServer);c.connect(b,this.sessionInfo,function(a,b){a?q.call(this,a.reason,a.code):(OT.debug("OT.Session: Received session state from Raptor",b),l=this.connection.id,p("connected"),this.connection.on("destroyed",s,this),this.connections.on({add:n,remove:y},this),this.streams.on({add:w,remove:v,update:u},this),this.dispatchEvent(new OT.SessionConnectEvent(OT.Event.names.SESSION_CONNECTED,b.connections,b.streams,b.archives)))}.bind(this))},F=function(){this.is("connecting")&&
OT.SessionInfo.get(this,D.bind(this),function(a){q.call(this,a.message+(a.code?" ("+a.code+")":""))}.bind(this))},D=function(b){this.is("connecting")&&(this.sessionInfo=b,this.sessionInfo.partnerId&&this.sessionInfo.partnerId!=a?(a=this.sessionInfo.partnerId,this.logEvent("Connect","Failure","reason","GetSessionInfo:"+OT.ExceptionCodes.AUTHENTICATION_ERROR+":Authentication Error: The apiKey passed into the session.connect method does not match the apiKey in the token or session you are trying to connect to."),
q.call(this,"Authentication Error: The apiKey passed into the session.connect method does not match the apiKey in the token or session you are trying to connect to.",OT.ExceptionCodes.AUTHENTICATION_ERROR)):G.call(this))};this.logEvent=function(b,c,d,e){b={action:b,variation:c,payload_type:d,payload:e,session_id:f,partner_id:a,widget_id:h,widget_type:"Controller"};this.connection&&this.connection.id?b.connection_id=this.connection.id:l&&(b.connection_id=l);g.logEvent(b)};this.connect=function(c,d,
g){if(this.is("connecting","connected"))OT.warn("OT.Session: Cannot connect, the session is already "+this.state);else{x.call(this);p("connecting");b=d;e?e=!1:h=OT.$.uuid();a=c.toString();0===OT.APIKEY.length&&(OT.APIKEY=a);g&&OT.$.isFunction(g)&&(this.once(OT.Event.names.SESSION_CONNECTED,g.bind(null,null)),this.once("sessionConnectFailed",g));if(!f)return setTimeout(q.bind(this,"SessionID is undefined. You must pass a sessionID to initSession.",OT.ExceptionCodes.INVALID_SESSION_ID)),this;this.logEvent("Connect",
"Attempt","userAgent|sdkVersion|chromeFrame",[navigator.userAgent,OT.properties.version,k.externalHost?"yes":"no"].map(function(a){return a.replace("|","\\|")}).join("|"));F.call(this)}};this.disconnect=function(){c&&c.isNot("disconnected")?(p("disconnecting"),c.disconnect()):x.call(this)};this.destroy=function(a,b){this.streams.destroy();this.connections.destroy();this.disconnect()};this.publish=function(b,d,e){if(this.isNot("connected"))return g.logError(1010,"tb.exception","We need to be connected before you can publish",
null,{action:"publish",variation:"Failure",payload_type:"reason",payload:"We need to be connected before you can publish",session_id:f,partner_id:a,widgetId:h,widget_type:"Controller"}),e&&OT.$.isFunction(e)&&OT.$.callAsync(e,new OT.Error(OT.ExceptionCodes.NOT_CONNECTED,"We need to be connected before you can publish")),null;if(!c||!c.permittedTo("publish"))return this.logEvent("publish","Failure","reason","This token does not allow publishing. The role must be at least `publisher` to enable this functionality"),
TB.handleJsException("This token does not allow publishing. The role must be at least `publisher` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_PUBLISH,{session:this}),null;if(!b||"string"===typeof b||b.nodeType==Node.ELEMENT_NODE)b=OT.initPublisher(this.apiKey,b,d);else if(b instanceof OT.Publisher)"session"in b&&(b.session&&"sessionId"in b.session)&&(b.session.sessionId===this.sessionId?OT.warn("Cannot publish "+b.guid+" again to "+this.sessionId+". Please call session.unpublish(publisher) first."):
OT.warn("Cannot publish "+b.guid+" publisher already attached to "+b.session.sessionId+". Please call session.unpublish(publisher) first."));else throw b="Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",OT.error(b),Error(b);if(e&&OT.$.isFunction(e))b.once("publishComplete",e);b._.publishToSession(this);return b};this.unpublish=function(a){a?a._.unpublishFromSession(this):OT.error("OT.Session.unpublish: publisher parameter missing.")};this.subscribe=
function(a,b,c,d){if(!this.connection||!this.connection.connectionId)throw a="Session.subscribe :: Connection required to subscribe",OT.error(a),Error(a);if(!a)throw a="Session.subscribe :: stream cannot be null",OT.error(a),Error(a);if(!a.hasOwnProperty("streamId"))throw a="Session.subscribe :: invalid stream object",OT.error(a),Error(a);b=new OT.Subscriber(b,OT.$.extend(c||{},{session:this}));if(d&&OT.$.isFunction(d))b.once("subscribeComplete",d);OT.subscribers.add(b);b.subscribe(a);return b};this.unsubscribe=
function(a){if(!a)throw OT.error("OT.Session.unsubscribe: subscriber cannot be null"),Error("OT.Session.unsubscribe: subscriber cannot be null");if(!a.stream)return OT.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1;OT.debug("OT.Session.unsubscribe: subscriber "+a.id);a.destroy();return!0};this.getSubscribersForStream=function(a){return OT.subscribers.where({streamId:a.id})};this.getPublisherForStream=function(a){if("string"!=typeof a)if("object"==typeof a&&
a&&a.hasOwnProperty("id"))a=a.id;else throw errorMsg="Session.getPublisherForStream :: Invalid stream type",OT.error(errorMsg),Error(errorMsg);return OT.publishers.where({streamId:a})[0]};this._={jsepSubscribe:function(a,b,d){return c.jsepSubscribe(a.connection.id,a.id,b,d)}.bind(this),jsepUnsubscribe:function(a){return c.jsepUnsubscribe(a.connection.id,a.id)}.bind(this),jsepCandidate:function(a,b,d){return c.jsepCandidate(a,b.id,d)}.bind(this),jsepOffer:function(a,b,d){return c.jsepOffer(a,b.id,
d)}.bind(this),jsepAnswer:function(a,b,d){return c.jsepAnswer(a,b.id,d)}.bind(this),dispatchSignal:function(a,b,c){a=new OT.SignalEvent(b,c,a);a.target=this;this.trigger(OT.Event.names.SIGNAL,a);b&&this.dispatchEvent(a)}.bind(this),modifySubscriber:function(a,b,d){return c.modifySubscriber(a,b,d)}.bind(this),createStream:function(a,b,d,e,f,g,h){c.createStream(a,b,d,e,f,g,h)}.bind(this),modifyStream:function(a,b,d){!a||!b||void 0===d?OT.error("OT.Session.modifyStream: must provide streamId, key and value to modify a stream property."):
c.updateStream(a,b,d)}.bind(this),destroyStream:function(a){c.destroyStream(a)}.bind(this)};this.signal=function(a,b){c.signal(a,b)};this.forceDisconnect=function(a,b){if(c&&c.permittedTo("forceDisconnect")){var e="string"===typeof a?a:a.id;if(b){var f=new d(this,b,{timeoutMessage:"Timed out while waiting for connection "+e+" to be force Disconnected."});f.failsOnExceptionCodes({1520:"This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality"});
r[e]=f}c.forceDisconnect(e)}else b&&OT.$.callAsync(b,new OT.Error(null,"This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality")),TB.handleJsException("This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,{session:this})};this.forceUnpublish=function(a,b){if(c&&c.permittedTo("forceUnpublish")){var e="string"===typeof a?this.streams.get(a):a;
if(b){var f=new d(this,b,{timeoutMessage:"Timed out while waiting for stream "+e.id+" to be force unpublished."});f.failsOnExceptionCodes({1530:"This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality"});m[e.id]=f}c.forceUnpublish(e.id)}else b&&OT.$.callAsync(b,new OT.Error(null,"This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality")),TB.handleJsException("This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality",
OT.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,{session:this})};this.getStateManager=function(){OT.warn("Fixme: Have not implemented session.getStateManager")};OT.$.defineGetters(this,{apiKey:function(){return a},token:function(){return b},connected:function(){return this.is("connected")},connection:function(){return c&&c.id?this.connections.get(c.id):null},capabilities:function(){return c?c.capabilities:new OT.Capabilities([])},sessionId:function(){return f},id:function(){return f}},!0)}else OT.upgradeSystemRequirements()}})(window);
(function(k){k=document.createElement("link");k.type="text/css";k.media="screen";k.rel="stylesheet";k.href=OT.properties.cssURL;(document.head||document.getElementsByTagName("head")[0]).appendChild(k)})(window);(function(k){"function"===typeof define&&define.amd&&define("TB",[],function(){return TB})})(window);
